<!DOCTYPE html>
<html lang="ru">
<head>
  <script>if(window.parent!==window)document.write('<style>.bottom-nav,#bottomNavBar{display:none!important}body{padding-bottom:0!important}#addProductWindow{bottom:0!important}</style>')</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä - –ö–µ—Ä–±–µ–Ω</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }
    input, textarea, select {
      font-family: inherit;
      font-size: 16px;
    }
    

  </style>
</head>
<body>
  <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ - –ù–ê –í–ï–°–¨ –≠–ö–†–ê–ù -->
  <div id="addProductWindow" style="position:fixed; top:0; left:0; right:0; bottom:56px; background:#fff; z-index:9650;">
    <div style="background:#fff; width:100%; height:100%; max-width:100%; max-height:100%; margin:0; border-radius:0; overflow:hidden; display:flex; flex-direction:column; contain:content;">
      
      <!-- –®–∞–ø–∫–∞ -->
      <div style="background:linear-gradient(90deg, #ff6b6b, #ee5a6f); color:white; padding:20px; display:flex; justify-content:space-between; align-items:center;">
        <div>
          <h2 style="margin:0; font-size:24px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
          <p style="margin:5px 0 0; opacity:0.9; ">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ</p>
        </div>
        <button onclick="closeAddProductWindow()" style="background:rgba(255,255,255,0.2); color:white; border:none; font-size:28px; width:48px; height:48px; min-width:48px; min-height:48px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0;">&times;</button>
      </div>

      <!-- –§–æ—Ä–º–∞ -->
      <div style="flex:1; overflow-y:auto; padding:20px; padding-top:24px;">
        <div style="display:flex; flex-direction:column; gap:18px;">
          
<input type="text" id="newTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="padding:14px; border:1px solid #ddd; border-radius:8px; min-height:48px; font-size:16px;">
          
          <textarea id="newDescription" placeholder="üìù –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–¥–ª—è –∫–æ—Ä–µ–π—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤, —á–∞—Å–æ–≤ –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="padding:14px; border:1px solid #ddd; border-radius:8px; min-height:70px; resize:vertical; font-size:16px;"></textarea>
          
          <input type="number" id="newCostPrice" placeholder="üíµ –¶–µ–Ω–∞ –∑–∞–∫—É–ø–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" step="0.01" inputmode="decimal" autocomplete="off" style="padding:14px; border:1px solid #ddd; border-radius:8px; min-height:48px; font-size:16px;">
          
          <input type="number" id="newPrice" placeholder="üí∞ –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (—Ä–æ–∑–Ω–∏—á–Ω–∞—è)" step="0.01" inputmode="decimal" autocomplete="off" style="padding:14px; border:1px solid #ddd; border-radius:8px; min-height:48px; font-size:16px;">
          
          <div id="profitDisplay" style="padding: 12px; background: #e8f5e9; border-radius: 8px; display: none; text-align: center;">
            <strong>üìä –ù–∞—Ü–µ–Ω–∫–∞:</strong> <span id="profitAmount">0</span> —Å–æ–º (<span id="profitPercent">0</span>%)
          </div>
          
          <div style="display:flex; gap:8px; align-items:center;">
            <select id="newCategory" style="flex:1; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:16px; min-height:48px;">
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
              <option value="–≤—Å–µ" data-category="–≤—Å–µ">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</option>
              <option value="–Ω–æ–∂–Ω–∏—Ü—ã" data-category="–Ω–æ–∂–Ω–∏—Ü—ã">‚úÇÔ∏è –ù–æ–∂–Ω–∏—Ü—ã</option>
              <option value="—Å–∫–æ—Ç—á" data-category="—Å–∫–æ—Ç—á">–°–∫–æ—Ç—á</option>
              <option value="–Ω–æ–∂" data-category="–Ω–æ–∂">üî™ –ù–æ–∂</option>
              <option value="–∫–æ—Ä–µ–π—Å–∫–∏–µ" data-category="–∫–æ—Ä–µ–π—Å–∫–∏–µ">–ö–æ—Ä–µ–π—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã</option>
              <option value="—á–∞—Å—ã" data-category="—á–∞—Å—ã">‚åö –ß–∞—Å—ã</option>
              <option value="—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" data-category="—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞">üîå –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
              <option value="–±—ã—Ç–æ–≤—ã–µ" data-category="–±—ã—Ç–æ–≤—ã–µ">–ë—ã—Ç–æ–≤—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏</option>
            </select>
            <button type="button" onclick="showNewCategoryInput()" style="width:48px; height:48px; min-width:48px; min-height:48px; flex-shrink:0; background:linear-gradient(135deg, #ff9a56, #ff6b35); color:white; border:none; border-radius:8px; cursor:pointer; font-size:20px; display:flex; align-items:center; justify-content:center;" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é">‚ûï</button>
          </div>
          
          <!-- –ü–æ–ª–µ –¥–ª—è –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
          <div id="newCategoryInputDiv" style="display:none;">
            <div style="display:flex; gap:8px; align-items:center;">
              <input type="text" id="newCategoryInput" placeholder="üÜï –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" style="flex:1; padding:14px; min-height:48px; border:2px solid #ff6b35; border-radius:8px; background:#fff8f5; font-size:16px;">
              <button type="button" onclick="hideNewCategoryInput()" style="width:48px; height:48px; min-width:48px; min-height:48px; flex-shrink:0; background:#dc3545; color:white; border:none; border-radius:8px; cursor:pointer; font-size:18px; display:flex; align-items:center; justify-content:center;">‚úï</button>
            </div>
            <p style="margin:5px 0 0; font-size:12px; color:#ff6b35;">‚ö° –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ —Ç–æ–≤–∞—Ä–∞</p>
          </div>
          
          <input type="number" id="newOptPrice" placeholder="–û–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞" inputmode="decimal" autocomplete="off" style="padding:14px; border:1px solid #ddd; border-radius:8px; min-height:48px; font-size:16px;">
          
          <input type="number" id="newOptQty" placeholder="–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –æ–ø—Ç–∞" inputmode="numeric" autocomplete="off" style="padding:14px; border:1px solid #ddd; border-radius:8px; min-height:48px; font-size:16px;">
          
          <input type="number" id="newMinQty" placeholder="–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏" inputmode="numeric" autocomplete="off" style="padding:14px; border:1px solid #ddd; border-radius:8px; min-height:48px; font-size:16px;">

          <input type="number" id="newStock" placeholder="üì¶ –û—Å—Ç–∞—Ç–æ–∫ (–µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî –±–µ–∑ –ª–∏–º–∏—Ç–∞)" min="0" step="1" inputmode="numeric" autocomplete="off" style="padding:14px; border:1px solid #ddd; border-radius:8px; min-height:48px; font-size:16px;">
          
          <!-- –†–µ–¥–∞–∫—Ç–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–∞ -->
          <div id="variantEditorSection"></div>
          
          <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤-–ø–∞—á–µ–∫ -->
          <div style="background:#f3e5f5; border:2px solid #9c27b0; border-radius:8px; padding:14px;">
            <div style="display:flex; align-items:center; gap:12px; margin-bottom:10px;">
              <input type="checkbox" id="newIsPack" style="width:24px; height:24px; min-width:24px; min-height:24px; cursor:pointer;" onchange="togglePackQtyField()">
              <label for="newIsPack" style="font-weight:600; color:#7b1fa2; cursor:pointer;">üì¶ –≠—Ç–æ –ø–∞—á–∫–∞ (–ø—Ä–æ–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–∞—á–∫–∞–º–∏)</label>
            </div>
            <input type="number" id="newPackQty" placeholder="–°–∫–æ–ª—å–∫–æ —à—Ç—É–∫ –≤ 1 –ø–∞—á–∫–µ (–Ω–∞–ø—Ä. 6)" min="1" step="1" inputmode="numeric" autocomplete="off" style="display:none; width:100%; padding:10px; border:1px solid #ce93d8; border-radius:6px;  background:#fce4ec; margin-bottom:8px;" oninput="updatePackCalculationPreview()">
            <input type="number" id="newPacksPerBox" placeholder="–°–∫–æ–ª—å–∫–æ –ø–∞—á–µ–∫ –≤ 1 –∫–æ—Ä–æ–±–∫–µ (–Ω–∞–ø—Ä. 20)" min="1" step="1" inputmode="numeric" autocomplete="off" style="display:none; width:100%; padding:10px; border:1px solid #ce93d8; border-radius:6px;  background:#fff3e0;" oninput="updatePackCalculationPreview()">
            <div id="packCalculationPreview" style="display:none; margin-top:8px; padding:10px; background:#e8f5e9; border-radius:6px; font-size:13px; color:#2e7d32;"></div>
          </div>
          
          <div style="display: flex; gap: 10px; align-items: center; width: 100%; overflow: hidden;">
            <input type="file" id="imageFile" accept="image/*" style="flex: 1; min-width: 0; padding:12px; min-height:48px; border:1px solid #ddd; border-radius:8px;">
            <input type="file" id="galleryFile" accept="image/*" style="display: none;">
            <button id="openGallery" style="padding:12px 15px; min-height:48px; background:#007bff; color:white; border:none; border-radius:8px; cursor:pointer; white-space:nowrap; flex-shrink: 0;" onclick="document.getElementById('galleryFile').click()">üìÅ –ì–∞–ª–µ—Ä–µ—è</button>
          </div>
          
          <input type="text" id="newImage" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" autocomplete="off" style="padding:14px; border:1px solid #ddd; border-radius:8px; min-height:48px;">
          
          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ -->
          <div style="background:#e3f2fd; border:2px solid #2196f3; border-radius:8px; padding:14px;">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
              <label style="font-weight:600; color:#1565c0;">üì∑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ (–¥–æ 5 —à—Ç)</label>
              <button type="button" onclick="addExtraPhotoField()" style="background:#2196f3; color:white; border:none; padding:10px 14px; min-height:44px; border-radius:6px; cursor:pointer; font-size:13px;">+ –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
            </div>
            <div id="extraPhotosContainer" style="display:flex; flex-direction:column; gap:10px;"></div>
            <div id="extraPhotosPreview" style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;"></div>
          </div>
          
          <button id="previewUrlBtn" style="padding:14px; min-height:48px; background:#6c757d; color:white; border:none; border-radius:8px; cursor:pointer;">üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
          
          <div id="imagePreview" style="display: none; text-align:center; padding:10px; background:#f8f9fa; border-radius:8px;">
            <img id="previewImg" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" style="max-width: 100%; max-height: 200px; border-radius:8px;">
          </div>
        </div>
      </div>
<!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
      <div style="padding:20px; background:#f8f9fa; border-top:1px solid #e0e0e0; display:flex; gap:10px;">
        <button id="addProductBtn" style="flex:1; padding:16px; min-height:52px; background:linear-gradient(90deg, #28a745, #20c997); color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600; font-size:16px;">‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
      </div>
  
     </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/exif-js@2.3.0/exif.min.js"></script>
<script>
// ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE ============
const firebaseConfig = {
  apiKey: "AIzaSyBRQ6hH7kXq7ApJmqbvTG1EQsXwxWEnaGg",
  authDomain: "svoysayet.firebaseapp.com",
  projectId: "svoysayet",
  storageBucket: "svoysayet.firebasestorage.app",
  messagingSenderId: "450143000217",
  appId: "1:450143000217:web:7495cefaea0b94966e8a08",
  measurementId: "G-Y8VG9E29FY"
};

let db, storage;
let products = [];

function initFirebase() {
  try {
    if (typeof firebase === 'undefined') throw new Error('Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    db = firebase.firestore();
    storage = firebase.storage();
    console.log('Firebase initialized successfully');
    loadProducts(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  } catch (error) {
    console.error('Firebase initialization error:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase: ' + error.message, 'error');
  }
}

if (typeof firebase !== 'undefined') {
  initFirebase();
} else {
  window.addEventListener('load', initFirebase);
}

// ============ –ó–ê–ì–†–£–ó–ö–ê –¢–û–í–ê–†–û–í ============
async function loadProducts() {
  try {
    const snapshot = await db.collection('products').orderBy('order', 'desc').get();
    products = [];
    snapshot.forEach(doc => {
      products.push({ id: doc.id, ...doc.data() });
    });
    console.log('Loaded products:', products.length);
  } catch (error) {
    console.error('Error loading products:', error);
  }
}

// ============ –ü–ï–†–ï–ú–ï–ù–ù–´–ï ============
let extraPhotoUrls = [];
let extraPhotoCounter = 0;
let packCalcPreviewTimeout = null;
const _packCalcIsIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

// ============ –°–ö–†–´–í–ê–ï–ú –ü–û–õ–Ø –¢–û–õ–¨–ö–û –î–õ–Ø –ê–î–ú–ò–ù–ê –û–¢ –ü–†–û–î–ê–í–¶–û–í ============
(function() {
  try {
    const sellerRaw = localStorage.getItem('currentSeller');
    if (sellerRaw && JSON.parse(sellerRaw).id) {
      // –ü—Ä–æ–¥–∞–≤–µ—Ü ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º —Ü–µ–Ω—É –∑–∞–∫—É–ø–∫–∏ –∏ –Ω–∞—Ü–µ–Ω–∫—É
      const costPriceField = document.getElementById('newCostPrice');
      const profitDisplay = document.getElementById('profitDisplay');
      if (costPriceField) costPriceField.style.display = 'none';
      if (profitDisplay) profitDisplay.style.display = 'none';
    }
  } catch(e) {}
})();

// ============ –§–£–ù–ö–¶–ò–Ø –ó–ê–ö–†–´–¢–ò–Ø –û–ö–ù–ê ============
function closeAddProductWindow() {
  window.location.href = 'profile.html';
}

// ============ –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–ê–¢–ï–ì–û–†–ò–ô ============
function showNewCategoryInput() {
  document.getElementById('newCategoryInputDiv').style.display = 'block';
  document.getElementById('newCategory').disabled = true;
  document.getElementById('newCategoryInput').focus();
}

function hideNewCategoryInput() {
  document.getElementById('newCategoryInputDiv').style.display = 'none';
  document.getElementById('newCategory').disabled = false;
  document.getElementById('newCategoryInput').value = '';
}

// ============ –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–ê–ß–ï–ö ============
function togglePackQtyField() {
  const isPackCheckbox = document.getElementById('newIsPack');
  const packQtyInput = document.getElementById('newPackQty');
  const packsPerBoxInput = document.getElementById('newPacksPerBox');
  const calcPreview = document.getElementById('packCalculationPreview');
  
  if (isPackCheckbox.checked) {
    packQtyInput.style.display = 'block';
    packsPerBoxInput.style.display = 'block';
    packQtyInput.placeholder = '–°–∫–æ–ª—å–∫–æ —à—Ç—É–∫ –≤ 1 –ø–∞—á–∫–µ (–Ω–∞–ø—Ä. 6)';
    if (!packQtyInput.value) packQtyInput.value = 6;
    if (!packsPerBoxInput.value) packsPerBoxInput.value = 20;
    updatePackCalculationPreview();
  } else {
    packQtyInput.style.display = 'none';
    packsPerBoxInput.style.display = 'none';
    calcPreview.style.display = 'none';
    packQtyInput.value = '';
    packsPerBoxInput.value = '';
  }
}

function doPackCalculation() {
  const packQty = parseInt(document.getElementById('newPackQty').value) || 0;
  const packsPerBox = parseInt(document.getElementById('newPacksPerBox').value) || 0;
  const calcPreview = document.getElementById('packCalculationPreview');
  
  if (packQty > 0 && packsPerBox > 0) {
    calcPreview.style.display = 'block';
    calcPreview.innerHTML = `
      <div style="font-weight:700;margin-bottom:4px;">üìä –†–∞—Å—á—ë—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:</div>
      <div>üì¶ 1 –ø–∞—á–∫–∞ = <b>${packQty}</b> —à—Ç</div>
      <div style="margin-top:4px;font-size:12px;color:#1565c0;">üí° –ö–ª–∏–µ–Ω—Ç –≤–≤–µ–¥—ë—Ç –∫–æ–ª-–≤–æ –ü–ê–ß–ï–ö, –∞ –Ω–µ —à—Ç—É–∫!</div>
    `;
  } else {
    calcPreview.style.display = 'none';
  }
}

function updatePackCalculationPreview() {
  if (_packCalcIsIOS) {
    return;
  }
  clearTimeout(packCalcPreviewTimeout);
  packCalcPreviewTimeout = setTimeout(doPackCalculation, 150);
}

// ============ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–û–¢–û ============
function addExtraPhotoField() {
  const container = document.getElementById('extraPhotosContainer');
  const currentFields = container.querySelectorAll('.extra-photo-field').length;
  
  if (currentFields >= 5) {
    Swal.fire('–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ', '–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∞–∫—Å–∏–º—É–º 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ', 'warning');
    return;
  }
  
  extraPhotoCounter++;
  const fieldId = extraPhotoCounter;
  
  const fieldDiv = document.createElement('div');
  fieldDiv.className = 'extra-photo-field';
  fieldDiv.id = `extraPhotoField_${fieldId}`;
  fieldDiv.style.cssText = 'display:flex; gap:8px; align-items:center;';
  fieldDiv.innerHTML = `
    <input type="file" accept="image/*" onchange="handleExtraPhotoFile(this, ${fieldId})" style="flex:1; padding:8px; border:1px solid #90caf9; border-radius:6px; font-size:12px;">
    <input type="text" placeholder="–∏–ª–∏ URL —Ñ–æ—Ç–æ" id="extraPhotoUrl_${fieldId}" onchange="handleExtraPhotoUrl(this, ${fieldId})" style="flex:1; padding:8px; border:1px solid #90caf9; border-radius:6px; font-size:12px;">
    <button type="button" onclick="removeExtraPhotoField(${fieldId})" style="background:#dc3545; color:white; border:none; width:32px; height:32px; border-radius:6px; cursor:pointer; font-size:16px;">‚úï</button>
  `;
  
  container.appendChild(fieldDiv);
}

async function handleExtraPhotoFile(input, fieldId) {
  const file = input.files[0];
  if (!file) return;
  
  try {
    Swal.fire({
      title: '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...',
      text: '–ü–æ–¥–æ–∂–¥–∏—Ç–µ...',
      allowOutsideClick: false,
      didOpen: () => Swal.showLoading()
    });
    
    const url = await uploadToImgBB(file);
    
    extraPhotoUrls = extraPhotoUrls.filter(p => p.fieldId !== fieldId);
    extraPhotoUrls.push({ fieldId, url });
    
    updateExtraPhotosPreview();
    Swal.close();
    
    Swal.fire({
      icon: 'success',
      title: '–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!',
      toast: true,
      position: 'bottom',
      timer: 2000,
      showConfirmButton: false
    });
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ: ' + error.message, 'error');
  }
}

function handleExtraPhotoUrl(input, fieldId) {
  const url = input.value.trim();
  if (!url) {
    extraPhotoUrls = extraPhotoUrls.filter(p => p.fieldId !== fieldId);
    updateExtraPhotosPreview();
    return;
  }
  
  extraPhotoUrls = extraPhotoUrls.filter(p => p.fieldId !== fieldId);
  extraPhotoUrls.push({ fieldId, url });
  updateExtraPhotosPreview();
}

function removeExtraPhotoField(fieldId) {
  const field = document.getElementById(`extraPhotoField_${fieldId}`);
  if (field) field.remove();
  
  extraPhotoUrls = extraPhotoUrls.filter(p => p.fieldId !== fieldId);
  updateExtraPhotosPreview();
}

function updateExtraPhotosPreview() {
  const preview = document.getElementById('extraPhotosPreview');
  if (!preview) return;
  
  preview.innerHTML = extraPhotoUrls.map(p => `
    <img src="${p.url}" alt="–§–æ—Ç–æ" style="width:60px; height:60px; object-fit:cover; border-radius:6px; border:2px solid #2196f3;">
  `).join('');
}

// ============ –ó–ê–ì–†–£–ó–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô ============
async function fixImageOrientation(file) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    
    reader.onload = (e) => {
      const img = new Image();
      
      img.onload = () => {
        console.log('üñºÔ∏è –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:', file.name, `${img.naturalWidth}x${img.naturalHeight}`);
        
        if (typeof EXIF === 'undefined') {
          console.warn('EXIF –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä—Ä–µ–∫—Ü–∏—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏');
          resolve(file);
          return;
        }
        
        EXIF.getData(img, function() {
          const orientation = EXIF.getTag(this, "Orientation") || 1;
          console.log('üìê EXIF Orientation:', orientation);
          
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          
          let width = img.naturalWidth;
          let height = img.naturalHeight;
          
          const MAX_SIZE = 1200;
          if (width > MAX_SIZE || height > MAX_SIZE) {
            const ratio = Math.min(MAX_SIZE / width, MAX_SIZE / height);
            width = Math.round(width * ratio);
            height = Math.round(height * ratio);
            console.log('üìâ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–º–µ–Ω—å—à–µ–Ω–æ –¥–æ:', width, 'x', height);
          }
          
          if (orientation > 4 && orientation < 9) {
            canvas.width = height;
            canvas.height = width;
          } else {
            canvas.width = width;
            canvas.height = height;
          }
          
          ctx.save();
          
          switch (orientation) {
            case 2: ctx.translate(width, 0); ctx.scale(-1, 1); break;
            case 3: ctx.translate(width, height); ctx.rotate(Math.PI); break;
            case 4: ctx.translate(0, height); ctx.scale(1, -1); break;
            case 5: ctx.rotate(0.5 * Math.PI); ctx.scale(1, -1); break;
            case 6: ctx.rotate(0.5 * Math.PI); ctx.translate(0, -height); break;
            case 7: ctx.rotate(0.5 * Math.PI); ctx.translate(width, -height); ctx.scale(-1, 1); break;
            case 8: ctx.rotate(-0.5 * Math.PI); ctx.translate(-width, 0); break;
          }
          
          ctx.drawImage(img, 0, 0, width, height);
          ctx.restore();
          
          canvas.toBlob((blob) => {
            if (blob) {
              const fixedFile = new File([blob], file.name, {
                type: file.type || 'image/jpeg',
                lastModified: Date.now()
              });
              console.log('‚úÖ –°–æ–∑–¥–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª:', Math.round(fixedFile.size / 1024), 'KB');
              resolve(fixedFile);
            } else {
              resolve(file);
            }
          }, file.type || 'image/jpeg', 0.92);
        });
      };
      
      img.onerror = () => resolve(file);
      img.src = e.target.result;
    };
    
    reader.onerror = () => resolve(file);
    reader.readAsDataURL(file);
  });
}

async function uploadToImgBB(file) {
  console.log('üì§ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –Ω–∞ ImgBB:', file.name);
  
  const fixedFile = await fixImageOrientation(file);
  console.log('üì§ –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –Ω–∞ ImgBB');
  
  const apiKey = '3dcd4dce37fa365cc2ee66890444ce4b';
  
  // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª –≤ base64
  const base64 = await new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => {
      const base64String = reader.result.split(',')[1];
      resolve(base64String);
    };
    reader.onerror = reject;
    reader.readAsDataURL(fixedFile);
  });

  const formData = new FormData();
  formData.append('image', base64);

  try {
    const res = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
      method: 'POST',
      body: formData
    });

    const data = await res.json();
    console.log('üì• –û—Ç–≤–µ—Ç ImgBB:', data);
    
    if (data.success && data.data.url) {
      console.log('‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ ImgBB:', data.data.url);
      return data.data.url;
    } else {
      throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ ImgBB: ' + (data.error?.message || JSON.stringify(data)));
    }
  } catch (err) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', err);
    throw err;
  }
}

async function checkImage(url) {
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => resolve(true);
    img.onerror = () => resolve(false);
    img.src = url;
  });
}

function sanitizeProductTitle(value) {
  if (typeof value !== 'string') return '';
  const trimmed = value.trim();
  const cleaned = trimmed.replace(/^[\s'"""'`¬¥¬´¬ª]+|[\s'"""'`¬¥¬´¬ª]+$/g, '').trim();
  return cleaned || trimmed;
}

// ============ –†–ê–°–ß–Å–¢ –ù–ê–¶–ï–ù–ö–ò ============
function setupProfitCalculator() {
  const costPriceInput = document.getElementById('newCostPrice');
  const salePriceInput = document.getElementById('newPrice');
  const profitDisplay = document.getElementById('profitDisplay');
  const profitAmount = document.getElementById('profitAmount');
  const profitPercent = document.getElementById('profitPercent');
  
  function calculateProfit() {
    const costPrice = parseFloat(costPriceInput.value) || 0;
    const salePrice = parseFloat(salePriceInput.value) || 0;
    
    if (costPrice > 0 && salePrice > 0) {
      const profit = salePrice - costPrice;
      const profitPercentage = ((profit / costPrice) * 100).toFixed(2);
      
      profitAmount.textContent = profit.toFixed(2);
      profitPercent.textContent = profitPercentage;
      profitDisplay.style.display = 'block';
      
      if (profit > 0) {
        profitDisplay.style.background = '#e8f5e9';
        profitDisplay.style.color = '#2e7d32';
      } else if (profit < 0) {
        profitDisplay.style.background = '#ffebee';
        profitDisplay.style.color = '#c62828';
      } else {
        profitDisplay.style.background = '#fff3e0';
        profitDisplay.style.color = '#ef6c00';
      }
    } else {
      profitDisplay.style.display = 'none';
    }
  }
  
  if (costPriceInput && salePriceInput) {
    if (_packCalcIsIOS) {
      costPriceInput.addEventListener('blur', calculateProfit);
      salePriceInput.addEventListener('blur', calculateProfit);
    } else {
      let profitCalculationTimeout = null;
      function debouncedCalculateProfit() {
        clearTimeout(profitCalculationTimeout);
        profitCalculationTimeout = setTimeout(calculateProfit, 300);
      }
      costPriceInput.addEventListener('input', debouncedCalculateProfit);
      salePriceInput.addEventListener('input', debouncedCalculateProfit);
    }
  }
}

// ============ –û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–ì–†–£–ó–ö–ò –§–ê–ô–õ–ê ============
document.addEventListener('DOMContentLoaded', function() {
  setupProfitCalculator();
  
  // –î–ª—è iOS - blur –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–∞—á–µ–∫
  if (_packCalcIsIOS) {
    const packQtyInput = document.getElementById('newPackQty');
    const packsPerBoxInput = document.getElementById('newPacksPerBox');
    if (packQtyInput) packQtyInput.addEventListener('blur', doPackCalculation);
    if (packsPerBoxInput) packsPerBoxInput.addEventListener('blur', doPackCalculation);
  }
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  const imageFileInput = document.getElementById('imageFile');
  if (imageFileInput) {
    imageFileInput.addEventListener('change', async function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const addBtn = document.getElementById('addProductBtn');
      addBtn.disabled = true;
      addBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...';
      
      try {
        const url = await uploadToImgBB(file);
        document.getElementById('newImage').value = url;
        
        // –ü–æ–∫–∞–∑ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        document.getElementById('previewImg').src = url;
        document.getElementById('imagePreview').style.display = 'block';
        
        addBtn.disabled = false;
        addBtn.textContent = '‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
        Swal.fire({ icon: 'success', title: '–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!', toast: true, position: 'bottom', timer: 2000, showConfirmButton: false });
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', err);
        Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
        addBtn.disabled = false;
        addBtn.textContent = '‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
      }
    });
  }
  
  // –ö–Ω–æ–ø–∫–∞ –≥–∞–ª–µ—Ä–µ–∏
  const galleryFileInput = document.getElementById('galleryFile');
  if (galleryFileInput) {
    galleryFileInput.addEventListener('change', async function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const addBtn = document.getElementById('addProductBtn');
      addBtn.disabled = true;
      addBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...';
      
      try {
        const url = await uploadToImgBB(file);
        document.getElementById('newImage').value = url;
        
        document.getElementById('previewImg').src = url;
        document.getElementById('imagePreview').style.display = 'block';
        
        addBtn.disabled = false;
        addBtn.textContent = '‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
        Swal.fire({ icon: 'success', title: '–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!', toast: true, position: 'bottom', timer: 2000, showConfirmButton: false });
      } catch (err) {
        Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
        addBtn.disabled = false;
        addBtn.textContent = '‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
      }
    });
  }
  
  // –ö–Ω–æ–ø–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ URL
  const previewBtn = document.getElementById('previewUrlBtn');
  if (previewBtn) {
    previewBtn.addEventListener('click', function() {
      const url = document.getElementById('newImage').value.trim();
      if (url) {
        document.getElementById('previewImg').src = url;
        document.getElementById('imagePreview').style.display = 'block';
      } else {
        Swal.fire('', '–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'info');
      }
    });
  }
});

// ============ –î–û–ë–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê ============
document.getElementById('addProductBtn').addEventListener('click', async function() {
  try {
    console.log('Add product button clicked');
    const newTitleEl = document.getElementById('newTitle');
    const rawTitle = newTitleEl ? newTitleEl.value : '';
    const title = sanitizeProductTitle(rawTitle);
    if (newTitleEl && title !== rawTitle.trim()) newTitleEl.value = title;
    
    const costPrice = parseFloat(document.getElementById('newCostPrice').value) || 0;
    const price = +document.getElementById('newPrice').value;
    let category = document.getElementById('newCategory').value;
    
    const newCatInput = document.getElementById('newCategoryInput').value.trim();
    if (newCatInput) {
      category = newCatInput.toLowerCase();
    }
    
    const optPrice = +document.getElementById('newOptPrice').value;
    const optQty = +document.getElementById('newOptQty').value;
    const minQty = +document.getElementById('newMinQty').value;
    
    const stockRaw = document.getElementById('newStock') ? String(document.getElementById('newStock').value).trim() : '';
    let stock = null;
    if (stockRaw !== '') {
      const parsed = parseInt(stockRaw, 10);
      if (isNaN(parsed) || parsed < 0) {
        Swal.fire('–û—à–∏–±–∫–∞', '–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º 0 –∏–ª–∏ –±–æ–ª—å—à–µ', 'warning');
        return;
      }
      stock = parsed;
    }
    
    const urlInput = document.getElementById('newImage').value.trim();
    let imageUrl = urlInput;
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!title) {
      Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'warning');
      return;
    }
    if (!price || price <= 0) {
      Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏', 'warning');
      return;
    }
    if (!imageUrl) {
      Swal.fire('–û—à–∏–±–∫–∞', '–£–∫–∞–∂–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª!', 'warning');
      return;
    }
    
    if (costPrice > 0 && price <= costPrice) {
      const result = await Swal.fire({
        title: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ!',
        text: '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞ —Ü–µ–Ω–µ –∑–∞–∫—É–ø–∫–∏. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: '–î–∞, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
        cancelButtonText: '–û—Ç–º–µ–Ω–∞'
      });
      if (!result.isConfirmed) return;
    }

    const addBtn = document.getElementById('addProductBtn');
    addBtn.disabled = true;
    addBtn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...';
    
    const isValidImage = await checkImage(imageUrl);
    if (!isValidImage) {
      addBtn.disabled = false;
      addBtn.textContent = '‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
      Swal.fire('–û—à–∏–±–∫–∞', '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª/URL.', 'error');
      return;
    }
    
    addBtn.textContent = '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...';

    let maxOrder = 0;
    products.forEach(p => {
      if (typeof p.order === 'number' && p.order > maxOrder) maxOrder = p.order;
    });

    const description = document.getElementById('newDescription').value.trim();
    const isPack = document.getElementById('newIsPack').checked;
    const packQty = parseInt(document.getElementById('newPackQty').value) || 6;
    const packsPerBox = parseInt(document.getElementById('newPacksPerBox').value) || 20;
    const extraImages = extraPhotoUrls.map(p => p.url).filter(url => url && url.trim());
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ–¥–∞–≤—Ü–∞ (–µ—Å–ª–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω) –∏–ª–∏ –∞–¥–º–∏–Ω
    let _sellerId = 'admin';
    let _sellerName = '–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
    try {
      const _sellerRaw = localStorage.getItem('currentSeller');
      if (_sellerRaw) {
        const _seller = JSON.parse(_sellerRaw);
        if (_seller && _seller.id) {
          _sellerId = _seller.id;
          _sellerName = _seller.name || '–ü—Ä–æ–¥–∞–≤–µ—Ü';
        }
      }
    } catch(e) {}
    
    const productData = { 
      title, 
      description: description || '',
      costPrice,
      price,
      category: category || '–≤—Å–µ',
      optPrice: optPrice > 0 ? optPrice : null,
      optQty: optQty > 0 ? optQty : null,
      minQty: minQty > 0 ? minQty : 1,
      ...(stock !== null ? { stock } : {}),
      image: imageUrl,
      extraImages: extraImages.length > 0 ? extraImages : [],
      order: maxOrder + 1,
      createdAt: Date.now(),
      isPack: isPack,
      packQty: isPack ? packQty : null,
      packsPerBox: isPack ? packsPerBox : null,
      sellerId: _sellerId,
      sellerName: _sellerName,
      variants: null
    };
    
    console.log('Adding product to Firestore:', productData);
    const docRef = await db.collection('products').add(productData);
    console.log('Product added with ID:', docRef.id);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –≤–≤–µ–¥–µ–Ω–∞
    const newCategoryInputValue = document.getElementById('newCategoryInput').value.trim();
    if (newCategoryInputValue) {
      await db.collection('seller_categories').add({
        name: newCategoryInputValue,
        sellerId: _sellerId,
        sellerName: _sellerName,
        createdAt: Date.now(),
        status: 'approved'
      });
    }
    
    Swal.fire('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!', '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞—Ç–∞–ª–æ–≥', 'success');
    
    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('newImage').value = '';
    document.getElementById('newTitle').value = '';
    document.getElementById('newDescription').value = '';
    document.getElementById('newCostPrice').value = '';
    document.getElementById('newPrice').value = '';
    document.getElementById('newCategory').value = '';
    document.getElementById('newCategoryInput').value = '';
    document.getElementById('newCategoryInputDiv').style.display = 'none';
    document.getElementById('newOptPrice').value = '';
    document.getElementById('newOptQty').value = '';
    document.getElementById('newMinQty').value = '';
    if (document.getElementById('newStock')) document.getElementById('newStock').value = '';
    document.getElementById('newIsPack').checked = false;
    document.getElementById('newPackQty').value = '';
    document.getElementById('newPackQty').style.display = 'none';
    document.getElementById('newPacksPerBox').value = '';
    document.getElementById('newPacksPerBox').style.display = 'none';
    document.getElementById('packCalculationPreview').style.display = 'none';
    document.getElementById('extraPhotosContainer').innerHTML = '';
    document.getElementById('extraPhotosPreview').innerHTML = '';
    extraPhotoUrls = [];
    document.getElementById('imageFile').value = '';
    document.getElementById('imagePreview').style.display = 'none';
    document.getElementById('profitDisplay').style.display = 'none';
    
    addBtn.disabled = false;
    addBtn.textContent = '‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
    
    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
    await loadProducts();
    
  } catch (error) {
    console.error('Error details:', error);
    document.getElementById('addProductBtn').disabled = false;
    document.getElementById('addProductBtn').textContent = '‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
    Swal.fire('–û—à–∏–±–∫–∞', `–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä: ${error.message}`, 'error');
  }
});
</script>

<script src="js/bottom-nav.js?v=20"></script>
</body>
</html>