<!DOCTYPE html>
<html lang="ru">
<head>
  <script>if(window.parent!==window)document.write('<style>.bottom-nav{display:none!important}body{padding-bottom:0!important}.main-container{height:100vh!important}.modal-overlay{bottom:0!important}</style>')</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏ - –ö–µ—Ä–±–µ–Ω</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }
    input, textarea, select {
      font-family: inherit;
      font-size: 16px;
    }
    
    /* SweetAlert –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
    .swal2-container {
      z-index: 999999 !important;
    }
    
    /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #fff;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: space-around;
      z-index: 99999;
    }
    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      color: #9e9e9e;
      text-decoration: none;
      position: relative;
    }
    .nav-item.active { color: #4CAF50; }
    .nav-item svg { width: 24px; height: 24px; fill: currentColor; }
    .nav-item span { font-size: 11px; }
    
    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .main-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 56px);
      background: #fff;
    }
    
    /* –®–∞–ø–∫–∞ */
    .page-header {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }
    .page-header h1 {
      margin: 0;
      font-size: 22px;
    }
    .page-header p {
      margin: 5px 0 0;
      opacity: 0.9;
      font-size: 14px;
    }
    .back-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      font-size: 28px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      padding: 15px;
      background: #f8f9fa;
      flex-shrink: 0;
    }
    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    .stat-card .label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }
    .stat-card .value {
      font-size: 24px;
      font-weight: 700;
    }
    .stat-card .value.green { color: #28a745; }
    .stat-card .value.orange { color: #fd7e14; }
    .stat-card .value.red { color: #dc3545; }
    .stat-card .value.blue { color: #007bff; }
    
    /* –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
    .filters-panel {
      padding: 15px;
      background: #f8f9fa;
      border-bottom: 1px solid #e0e0e0;
      flex-shrink: 0;
    }
    .controls-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    .controls-row select,
    .controls-row input {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      min-width: 150px;
    }
    .controls-row button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }
    .btn-primary {
      background: linear-gradient(90deg, #28a745, #20c997);
      color: white;
    }
    .btn-blue {
      background: #007bff;
      color: white;
    }
    
    /* –ö–æ–Ω—Ç–µ–Ω—Ç */
    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ */
    .seller-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 15px;
      overflow: hidden;
    }
    .seller-card.blocked {
      background: #fff5f5;
      border: 1px solid #ffcdd2;
    }
    .seller-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 15px;
      border-bottom: 1px solid #f0f0f0;
    }
    .seller-info h3 {
      margin: 0 0 5px 0;
      font-size: 16px;
      color: #333;
    }
    .seller-info p {
      margin: 3px 0;
      font-size: 13px;
      color: #666;
    }
    .seller-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }
    .seller-status.active {
      background: #d4edda;
      color: #155724;
    }
    .seller-status.blocked {
      background: #f8d7da;
      color: #721c24;
    }
    .seller-status.pending {
      background: #fff3cd;
      color: #856404;
    }
    .seller-stats {
      display: flex;
      gap: 20px;
      padding: 12px 15px;
      background: #f8f9fa;
      font-size: 13px;
    }
    .seller-stats span {
      color: #666;
    }
    .seller-stats strong {
      color: #333;
    }
    .seller-actions {
      display: flex;
      gap: 8px;
      padding: 12px 15px;
      flex-wrap: wrap;
    }
    .seller-actions button {
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .btn-success { background: #28a745; color: white; }
    .btn-warning { background: #ffc107; color: #000; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-info { background: #17a2b8; color: white; }
    .btn-secondary { background: #6c757d; color: white; }
    
    /* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    .empty-state .icon {
      font-size: 64px;
      margin-bottom: 15px;
    }
    .empty-state p {
      font-size: 16px;
    }
    
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 56px;
      background: rgba(0,0,0,0.5);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-header h2 {
      margin: 0;
      font-size: 18px;
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }
    .modal-body {
      padding: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      font-size: 14px;
      color: #333;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
    }
    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #e0e0e0;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    /* –ü–æ–∏—Å–∫ */
    .search-box {
      flex: 1;
      min-width: 200px;
      max-width: 300px;
    }
    
    @media (max-width: 600px) {
      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }
      .controls-row {
        flex-direction: column;
        align-items: stretch;
      }
      .search-box {
        max-width: none;
      }
    }
  </style>
</head>
<body>

<div class="main-container">
  <!-- –®–∞–ø–∫–∞ -->
  <div class="page-header">
    <div>
      <h1>üè™ –ü—Ä–æ–¥–∞–≤—Ü—ã</h1>
      <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏ –º–∞–≥–∞–∑–∏–Ω–∞</p>
    </div>
    <button class="back-btn" onclick="window.location.href='profile.html'">‚Üê</button>
  </div>
  
  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="label">üë• –í—Å–µ–≥–æ</div>
      <div class="value blue" id="totalSellers">0</div>
    </div>
    <div class="stat-card">
      <div class="label">‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
      <div class="value green" id="activeSellers">0</div>
    </div>
    <div class="stat-card">
      <div class="label">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</div>
      <div class="value red" id="blockedSellers">0</div>
    </div>
    <div class="stat-card">
      <div class="label">üì¶ –¢–æ–≤–∞—Ä–æ–≤</div>
      <div class="value orange" id="totalProducts">0</div>
    </div>
  </div>
  
  <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
  <div class="filters-panel">
    <div class="controls-row">
      <input type="text" id="searchSeller" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É..." oninput="filterSellers()">
      <select id="statusFilter" onchange="filterSellers()">
        <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <option value="active">‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ</option>
        <option value="blocked">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
        <option value="pending">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</option>
      </select>
      <button class="btn-blue" onclick="loadSellers()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
  </div>
  
  <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ -->
  <div class="content-area" id="sellersContainer">
    <div class="empty-state">
      <div class="icon">‚è≥</div>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤...</p>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞ -->
<div class="modal-overlay" id="sellerProductsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="sellerProductsTitle">üì¶ –¢–æ–≤–∞—Ä—ã –ø—Ä–æ–¥–∞–≤—Ü–∞</h2>
      <button class="modal-close" onclick="closeSellerProductsModal()">√ó</button>
    </div>
    <div class="modal-body" id="sellerProductsList">
      <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeSellerProductsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
<nav class="bottom-nav">
  <a href="index.html" class="nav-item">
    <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    <span>–ì–ª–∞–≤–Ω–∞—è</span>
  </a>
  <a href="index.html#favorites" class="nav-item">
    <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
    <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
  </a>
  <a href="cart.html" class="nav-item">
    <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
    <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
  </a>
  <a href="profile.html" class="nav-item active">
    <svg viewBox="0 0 24 24"><path d="M12 12c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4zm0 2c-2.7 0-8 1.3-8 4v2h16v-2c0-2.7-5.3-4-8-4z"/></svg>
    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
  </a>
</nav>

<script>
// Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const firebaseConfig = {
  apiKey: "AIzaSyBRQ6hH7kXq7ApJmqbvTG1EQsXwxWEnaGg",
  authDomain: "svoysayet.firebaseapp.com",
  projectId: "svoysayet",
  storageBucket: "svoysayet.firebasestorage.app",
  messagingSenderId: "450143000217",
  appId: "1:450143000217:web:7495cefaea0b94966e8a08",
  measurementId: "G-Y8VG9E29FY"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let sellers = [];
let products = [];

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', async function() {
  console.log('üè™ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏...');
  
  try {
    await loadProducts();
    await loadSellers();
    console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
    document.getElementById('sellersContainer').innerHTML = `
      <div class="empty-state">
        <div class="icon">‚ùå</div>
        <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</p>
      </div>
    `;
  }
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
async function loadProducts() {
  const snapshot = await db.collection('products').get();
  products = [];
  snapshot.forEach(doc => {
    products.push({ id: doc.id, ...doc.data() });
  });
  console.log('üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤:', products.length);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
async function loadSellers() {
  try {
    const snapshot = await db.collection('sellers').get();
    sellers = [];
    snapshot.forEach(doc => {
      sellers.push({ id: doc.id, ...doc.data() });
    });
    
    console.log('üë• –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤:', sellers.length);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    updateStats();
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
    filterSellers();
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤:', error);
    throw error;
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStats() {
  const active = sellers.filter(s => s.status !== 'blocked' && s.status !== 'pending').length;
  const blocked = sellers.filter(s => s.status === 'blocked').length;
  const pending = sellers.filter(s => s.status === 'pending').length;
  
  // –°—á–∏—Ç–∞–µ–º —Ç–æ–≤–∞—Ä—ã –≤—Å–µ—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
  const sellerProductsCount = products.filter(p => p.sellerId).length;
  
  document.getElementById('totalSellers').textContent = sellers.length;
  document.getElementById('activeSellers').textContent = active;
  document.getElementById('blockedSellers').textContent = blocked;
  document.getElementById('totalProducts').textContent = sellerProductsCount;
}

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
function filterSellers() {
  const search = document.getElementById('searchSeller').value.toLowerCase().trim();
  const status = document.getElementById('statusFilter').value;
  
  let filtered = sellers;
  
  // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
  if (status !== 'all') {
    if (status === 'active') {
      filtered = filtered.filter(s => s.status !== 'blocked' && s.status !== 'pending');
    } else {
      filtered = filtered.filter(s => s.status === status);
    }
  }
  
  // –ü–æ–∏—Å–∫
  if (search) {
    filtered = filtered.filter(s => 
      (s.name && s.name.toLowerCase().includes(search)) ||
      (s.phone && s.phone.includes(search)) ||
      (s.city && s.city.toLowerCase().includes(search))
    );
  }
  
  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–≤–µ—Ä—Ö—É, –ø–æ—Ç–æ–º –ø–æ –∏–º–µ–Ω–∏
  filtered.sort((a, b) => {
    if (a.status === 'blocked' && b.status !== 'blocked') return 1;
    if (a.status !== 'blocked' && b.status === 'blocked') return -1;
    return (a.name || '').localeCompare(b.name || '');
  });
  
  renderSellers(filtered);
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
function renderSellers(list) {
  const container = document.getElementById('sellersContainer');
  
  if (list.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="icon">üè™</div>
        <p>–ü—Ä–æ–¥–∞–≤—Ü–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = list.map(seller => {
    const isBlocked = seller.status === 'blocked';
    const isPending = seller.status === 'pending';
    
    // –°—á–∏—Ç–∞–µ–º —Ç–æ–≤–∞—Ä—ã –ø—Ä–æ–¥–∞–≤—Ü–∞
    const sellerProducts = products.filter(p => p.sellerId === seller.id);
    
    // –°—Ç–∞—Ç—É—Å
    let statusClass = 'active';
    let statusText = '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω';
    if (isBlocked) {
      statusClass = 'blocked';
      statusText = 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
    } else if (isPending) {
      statusClass = 'pending';
      statusText = '‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏';
    }
    
    // –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    let regDate = '';
    if (seller.createdAt) {
      const date = new Date(seller.createdAt);
      regDate = date.toLocaleDateString('ru-RU');
    }
    
    return `
      <div class="seller-card ${isBlocked ? 'blocked' : ''}">
        <div class="seller-header">
          <div class="seller-info">
            <h3>${seller.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</h3>
            <p>üì± ${seller.phone || '–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
            <p>üìç ${seller.city || '–ì–æ—Ä–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
            ${seller.telegramId ? `<p>üì≤ Telegram: ${seller.telegramId}</p>` : ''}
          </div>
          <span class="seller-status ${statusClass}">${statusText}</span>
        </div>
        
        <div class="seller-stats">
          <span>üì¶ –¢–æ–≤–∞—Ä–æ–≤: <strong>${sellerProducts.length}</strong></span>
          ${regDate ? `<span>üìÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: <strong>${regDate}</strong></span>` : ''}
        </div>
        
        <div class="seller-actions">
          ${isBlocked 
            ? `<button class="btn-success" onclick="unblockSeller('${seller.id}')">‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>`
            : `<button class="btn-warning" onclick="blockSeller('${seller.id}')">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>`
          }
          <button class="btn-info" onclick="viewSellerProducts('${seller.id}', '${(seller.name || '').replace(/'/g, "\\'")}')">üì¶ –¢–æ–≤–∞—Ä—ã (${sellerProducts.length})</button>
          <button class="btn-danger" onclick="deleteSeller('${seller.id}', '${(seller.name || '').replace(/'/g, "\\'")}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>
    `;
  }).join('');
}

// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞
async function blockSeller(sellerId) {
  const seller = sellers.find(s => s.id === sellerId);
  
  const result = await Swal.fire({
    title: 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞?',
    html: `–ü—Ä–æ–¥–∞–≤–µ—Ü <strong>"${seller?.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}"</strong> –Ω–µ —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å',
    confirmButtonColor: '#ffc107',
    cancelButtonText: '–û—Ç–º–µ–Ω–∞'
  });
  
  if (result.isConfirmed) {
    try {
      await db.collection('sellers').doc(sellerId).update({ status: 'blocked' });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
      const idx = sellers.findIndex(s => s.id === sellerId);
      if (idx !== -1) sellers[idx].status = 'blocked';
      
      updateStats();
      filterSellers();
      
      Swal.fire('–ì–æ—Ç–æ–≤–æ!', '–ü—Ä–æ–¥–∞–≤–µ—Ü –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', error);
      Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞', 'error');
    }
  }
}

// –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞
async function unblockSeller(sellerId) {
  try {
    await db.collection('sellers').doc(sellerId).update({ status: 'active' });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
    const idx = sellers.findIndex(s => s.id === sellerId);
    if (idx !== -1) sellers[idx].status = 'active';
    
    updateStats();
    filterSellers();
    
    Swal.fire('–ì–æ—Ç–æ–≤–æ!', '–ü—Ä–æ–¥–∞–≤–µ—Ü —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞', 'error');
  }
}

// –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞
async function deleteSeller(sellerId, sellerName) {
  const sellerProducts = products.filter(p => p.sellerId === sellerId);
  
  const result = await Swal.fire({
    title: 'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞?',
    html: `
      –ü—Ä–æ–¥–∞–≤–µ—Ü <strong>"${sellerName}"</strong> –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω.<br><br>
      ${sellerProducts.length > 0 
        ? `<span style="color:#ff9800;">‚ö†Ô∏è –£ –ø—Ä–æ–¥–∞–≤—Ü–∞ ${sellerProducts.length} —Ç–æ–≤–∞—Ä–æ–≤. –¢–æ–≤–∞—Ä—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.</span>`
        : '<span style="color:#666;">–£ –ø—Ä–æ–¥–∞–≤—Ü–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.</span>'
      }
    `,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: '–£–¥–∞–ª–∏—Ç—å',
    confirmButtonColor: '#dc3545',
    cancelButtonText: '–û—Ç–º–µ–Ω–∞'
  });
  
  if (result.isConfirmed) {
    try {
      await db.collection('sellers').doc(sellerId).delete();
      
      // –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
      sellers = sellers.filter(s => s.id !== sellerId);
      
      updateStats();
      filterSellers();
      
      Swal.fire('–ì–æ—Ç–æ–≤–æ!', '–ü—Ä–æ–¥–∞–≤–µ—Ü —É–¥–∞–ª—ë–Ω', 'success');
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
      Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞', 'error');
    }
  }
}

// –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞
function viewSellerProducts(sellerId, sellerName) {
  const sellerProducts = products.filter(p => p.sellerId === sellerId);
  
  document.getElementById('sellerProductsTitle').textContent = `üì¶ –¢–æ–≤–∞—Ä—ã: ${sellerName} (${sellerProducts.length})`;
  
  const container = document.getElementById('sellerProductsList');
  
  if (sellerProducts.length === 0) {
    container.innerHTML = `
      <div style="text-align:center; padding:40px; color:#999;">
        <div style="font-size:48px; margin-bottom:10px;">üì¶</div>
        <p>–£ –ø—Ä–æ–¥–∞–≤—Ü–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</p>
      </div>
    `;
  } else {
    container.innerHTML = sellerProducts.map(p => `
      <div style="display:flex; gap:12px; padding:12px; border:1px solid #e0e0e0; border-radius:8px; margin-bottom:10px; align-items:center;">
        <img src="${p.image || 'https://via.placeholder.com/60x60?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'}" 
             style="width:60px; height:60px; object-fit:cover; border-radius:6px; flex-shrink:0;"
             onerror="this.src='https://via.placeholder.com/60x60?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'">
        <div style="flex:1; min-width:0;">
          <div style="font-weight:600; font-size:14px; color:#333; margin-bottom:4px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
            ${p.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}
          </div>
          <div style="font-size:15px; color:#e53935; font-weight:600;">${p.price || 0} —Å–æ–º</div>
          <div style="font-size:12px; color:#666;">üìÅ ${p.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}</div>
        </div>
      </div>
    `).join('');
  }
  
  document.getElementById('sellerProductsModal').classList.add('active');
}

// –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤
function closeSellerProductsModal() {
  document.getElementById('sellerProductsModal').classList.remove('active');
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
document.getElementById('sellerProductsModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeSellerProductsModal();
  }
});
</script>

</body>
</html>
