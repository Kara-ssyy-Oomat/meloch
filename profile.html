<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#4CAF50">
  
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-kerben.jpg">
  <link rel="icon" type="image/jpeg" href="icon-kerben.jpg">
  
  <title>–ü—Ä–æ—Ñ–∏–ª—å - –ö–µ—Ä–±–µ–Ω</title>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
      padding-bottom: 56px;
    }
    
    .profile-header {
      background: linear-gradient(135deg, #4CAF50, #2e7d32);
      color: white;
      padding: 25px 20px;
    }
    
    .profile-user {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .profile-avatar {
      width: 60px;
      height: 60px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
    }
    
    .profile-info { flex: 1; cursor: pointer; }
    .profile-name { font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
    .profile-phone { font-size: 14px; opacity: 0.9; margin-top: 2px; }
    
    .logout-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
    }
    
    .stats-row {
      display: flex;
      background: white;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .stat-item {
      flex: 1;
      text-align: center;
      padding: 20px;
      border-right: 1px solid #e0e0e0;
    }
    
    .stat-item:last-child { border-right: none; }
    .stat-value { font-size: 24px; font-weight: 600; color: #333; }
    .stat-label { font-size: 12px; color: #888; margin-top: 4px; }
    
    .menu-section {
      background: white;
      margin-top: 10px;
    }
    
    .menu-section-title {
      padding: 16px 20px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 15px;
      font-weight: 600;
      color: #28a745;
    }
    
    .menu-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }
    
    .menu-item:active { background: #f5f5f5; }
    
    .menu-item-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .menu-icon { font-size: 20px; }
    .menu-text { font-size: 15px; color: #333; }
    .menu-arrow { color: #ccc; font-size: 18px; }
    .menu-badge { font-size: 13px; color: #888; margin-right: 8px; }
    
    .orders-section {
      margin-top: 15px;
      padding: 0 15px;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
    }
    
    .order-card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .order-id { font-weight: 700; font-size: 15px; color: #333; }
    
    .order-status {
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      color: white;
    }
    
    .order-date { font-size: 14px; color: #666; margin-bottom: 5px; }
    .order-items { font-size: 14px; color: #666; margin-bottom: 8px; }
    .order-total { font-size: 18px; font-weight: 700; color: #4CAF50; }
    
    .login-container {
      padding: 40px 20px;
      text-align: center;
    }
    
    .login-icon { font-size: 64px; margin-bottom: 20px; }
    .login-title { font-size: 20px; font-weight: 600; color: #333; margin-bottom: 10px; }
    .login-subtitle { font-size: 14px; color: #666; margin-bottom: 30px; }
    
    .login-btn {
      display: inline-block;
      background: linear-gradient(135deg, #4CAF50, #2e7d32);
      color: white;
      padding: 14px 40px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }
    
    .register-link {
      margin-top: 15px;
      font-size: 14px;
      color: #666;
    }
    
    .register-link a { color: #4CAF50; text-decoration: none; }
    
    .empty-orders {
      text-align: center;
      padding: 40px;
      color: #999;
    }
    
    .empty-orders-icon { font-size: 48px; margin-bottom: 10px; }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #fff;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: space-around;
      z-index: 9999;
    }
    
    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      color: #9e9e9e;
      text-decoration: none;
      position: relative;
    }
    
    .nav-item.active { color: #4CAF50; }
    .nav-item svg { width: 24px; height: 24px; fill: currentColor; }
    .nav-item span { font-size: 11px; }
    
    .nav-badge {
      position: absolute;
      top: 6px;
      right: calc(50% - 16px);
      background: #e53935;
      color: white;
      font-size: 10px;
      min-width: 16px;
      height: 16px;
      border-radius: 8px;
      display: none;
      align-items: center;
      justify-content: center;
    }
    
    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal-window {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 56px;
      background: #f5f5f5;
      z-index: 9500;
    }
    
    .modal-header {
      background: #fff;
      padding: 15px 20px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }
    
    .modal-title {
      font-size: 17px;
      font-weight: 600;
      color: #333;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: #666;
      font-size: 24px;
      cursor: pointer;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }
    
    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: #333;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
    }
    
    .admin-menu-item {
      background: linear-gradient(135deg, #2e7d32, #4caf50);
      color: white !important;
    }
    
    .admin-menu-item .menu-text { color: white; }
    .admin-menu-item .menu-arrow { color: white; }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loader-overlay {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      z-index: 10;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    
    .loader-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #e0e0e0;
      border-top: 5px solid #333;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    /* –¢–∞–±—ã –¥–ª—è –ø—Ä–æ–¥–∞–≤—Ü–∞ */
    .tabs {
      display: flex;
      border-bottom: 1px solid #e0e0e0;
      background: #fff;
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px;
      background: #f5f5f5;
      color: #333;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }
    
    .tab-btn.active {
      background: #333;
      color: white;
    }
  </style>
  
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
  <div id="profileContent">
    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
  </div>
  
  <!-- –û–∫–Ω–æ –∂–∞–ª–æ–±—ã -->
  <div id="complaintWindow" class="modal-window">
    <div style="height:100%; display:flex; flex-direction:column;">
      <div class="modal-header">
        <div class="modal-title">‚ö†Ô∏è –ñ–∞–ª–æ–±–∞</div>
        <button class="modal-close" onclick="closeComplaintWindow()">‚úï</button>
      </div>
      <div style="flex:1; overflow-y:auto; padding:20px; background:#fff;">
        <div class="form-group">
          <label class="form-label">–í–∞—à–µ –∏–º—è:</label>
          <input type="text" id="complaintName" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
        </div>
        <div class="form-group">
          <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
          <input type="tel" id="complaintPhone" class="form-input" placeholder="+996 XXX XXX XXX">
        </div>
        <div class="form-group">
          <label class="form-label">–¢–µ–º–∞ –∂–∞–ª–æ–±—ã:</label>
          <select id="complaintCategory" class="form-select">
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
            <option value="quality">–ö–∞—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞</option>
            <option value="delivery">–ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</option>
            <option value="service">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</option>
            <option value="price">–ù–µ–≤–µ—Ä–Ω–∞—è —Ü–µ–Ω–∞</option>
            <option value="other">–î—Ä—É–≥–æ–µ</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:</label>
          <textarea id="complaintText" class="form-textarea" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É..."></textarea>
        </div>
      </div>
      <div style="padding:15px 20px; background:#fff; border-top:1px solid #e0e0e0;">
        <button class="submit-btn" onclick="sendComplaint()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É</button>
      </div>
    </div>
  </div>
  
  <!-- –û–∫–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
  <div id="suggestionWindow" class="modal-window">
    <div style="height:100%; display:flex; flex-direction:column; position:relative;">
      <div class="modal-header">
        <div class="modal-title">üí° –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–æ–≤–∞—Ä</div>
        <button class="modal-close" onclick="closeSuggestionWindow()">‚úï</button>
      </div>
      <div style="flex:1; overflow-y:auto; padding:20px; background:#fff;">
        <div class="form-group">
          <label class="form-label">–í–∞—à–µ –∏–º—è:</label>
          <input type="text" id="suggestionName" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
        </div>
        <div class="form-group">
          <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
          <input type="tel" id="suggestionPhone" class="form-input" placeholder="+996 XXX XXX XXX">
        </div>
        <div class="form-group">
          <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:</label>
          <input type="text" id="suggestionProductName" class="form-input" placeholder="–ö–∞–∫–æ–π —Ç–æ–≤–∞—Ä –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤–∏–¥–µ—Ç—å?">
        </div>
        <div class="form-group">
          <label class="form-label">–ó–∞ —Å–∫–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å –ø–æ–∫—É–ø–∞–µ—Ç–µ:</label>
          <input type="number" id="suggestionCurrentPrice" class="form-input" placeholder="–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ —É –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–¥–∞–≤—Ü–∞">
        </div>
        <div class="form-group">
          <label class="form-label">–ñ–µ–ª–∞–µ–º–∞—è —Ü–µ–Ω–∞:</label>
          <input type="number" id="suggestionPrice" class="form-input" placeholder="–ó–∞ —Å–∫–æ–ª—å–∫–æ –≤—ã –≥–æ—Ç–æ–≤—ã –∫—É–ø–∏—Ç—å?">
        </div>
        <div class="form-group">
          <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
          <textarea id="suggestionDescription" class="form-textarea" placeholder="–û–ø–∏—à–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
          <input type="file" id="suggestionPhoto" accept="image/*" class="form-input" style="background:white;">
        </div>
      </div>
      <div style="padding:15px 20px; background:#fff; border-top:1px solid #e0e0e0;">
        <button id="suggestionSubmitBtn" class="submit-btn" onclick="sendSuggestion()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
      </div>
      <div id="suggestionLoader" class="loader-overlay">
        <div class="loader-spinner"></div>
        <p style="margin-top:20px; color:#333; font-size:16px; font-weight:600;">–û—Ç–ø—Ä–∞–≤–∫–∞...</p>
      </div>
    </div>
  </div>
  
  <!-- –û–∫–Ω–æ "–°—Ç–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–æ–º" -->
  <div id="becomeSellerWindow" class="modal-window">
    <div style="height:100%; display:flex; flex-direction:column; position:relative;">
      <div class="modal-header">
        <div class="modal-title">üè™ –°—Ç–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–æ–º</div>
        <button class="modal-close" onclick="closeBecomeSellerWindow()">‚úï</button>
      </div>
      <div class="tabs">
        <button id="sellerTabRegister" class="tab-btn active" onclick="switchSellerTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <button id="sellerTabLogin" class="tab-btn" onclick="switchSellerTab('login')">–í—Ö–æ–¥</button>
      </div>
      
      <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
      <div id="sellerRegisterForm" style="flex:1; overflow-y:auto; padding:20px; background:#fff;">
        <div class="form-group">
          <label class="form-label">–§–ò–û / –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏:</label>
          <input type="text" id="sellerName" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏">
        </div>
        <div class="form-group">
          <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω (–¥–ª—è –≤—Ö–æ–¥–∞):</label>
          <input type="tel" id="sellerPhone" class="form-input" placeholder="+996 XXX XXX XXX">
        </div>
        <div class="form-group">
          <label class="form-label">–ü–∞—Ä–æ–ª—å:</label>
          <input type="password" id="sellerPassword" class="form-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å (–º–∏–Ω. 4 —Å–∏–º–≤–æ–ª–∞)">
        </div>
        <div class="form-group">
          <label class="form-label">–ì–æ—Ä–æ–¥/–†–µ–≥–∏–æ–Ω:</label>
          <input type="text" id="sellerCity" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–∏—à–∫–µ–∫, –û—à">
        </div>
        <div class="form-group">
          <label class="form-label">–ö–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å:</label>
          <input type="text" id="sellerProducts" class="form-input" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤">
        </div>
        <div class="form-group">
          <label class="form-label">Telegram ID:</label>
          <input type="text" id="sellerTelegramId" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456789">
          <p style="margin:5px 0 0; font-size:11px; color:#888;">–£–∑–Ω–∞–π—Ç–µ ID —É @userinfobot –≤ Telegram</p>
        </div>
        <button id="sellerSubmitBtn" class="submit-btn" onclick="registerSeller()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      </div>
      
      <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
      <div id="sellerLoginForm" style="display:none; flex:1; overflow-y:auto; padding:20px; background:#fff;">
        <div class="form-group">
          <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
          <input type="tel" id="sellerLoginPhone" class="form-input" placeholder="+996 XXX XXX XXX">
        </div>
        <div class="form-group">
          <label class="form-label">–ü–∞—Ä–æ–ª—å:</label>
          <input type="password" id="sellerLoginPassword" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
        </div>
        <button class="submit-btn" onclick="loginSeller()">–í–æ–π—Ç–∏</button>
      </div>
      
      <div id="sellerLoader" class="loader-overlay">
        <div class="loader-spinner"></div>
        <p style="margin-top:20px; color:#333; font-size:16px; font-weight:600;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
      </div>
    </div>
  </div>
  
  <!-- –û–∫–Ω–æ –∑–∞–∫–∞–∑–æ–≤ -->
  <div id="ordersWindow" class="modal-window">
    <div style="height:100%; display:flex; flex-direction:column;">
      <div class="modal-header">
        <div style="display:flex; align-items:center; gap:15px;">
          <button onclick="closeOrdersWindow()" style="background:none; border:none; color:#333; font-size:20px; cursor:pointer;">‚Üê</button>
          <div class="modal-title">üìã –ú–æ–∏ –∑–∞–∫–∞–∑—ã</div>
        </div>
        <button class="modal-close" onclick="closeOrdersWindow()">‚úï</button>
      </div>
      <div id="ordersWindowContent" style="flex:1; overflow-y:auto; background:#fff;">
        <!-- –ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>
  </div>
  
  <nav class="bottom-nav">
    <a href="index.html" class="nav-item">
      <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
      <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </a>
    <a href="index.html#categories" class="nav-item">
      <svg viewBox="0 0 24 24"><path d="M3 5h6v6H3V5zm0 8h6v6H3v-6zm8-8h6v6h-6V5zm0 8h6v6h-6v-6z"/></svg>
      <span>–ú–µ–Ω—é</span>
    </a>
    <a href="cart.html" class="nav-item">
      <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM7.2 14.6L8.2 12h7.4c.8 0 1.4-.4 1.7-1l3.9-7-1.7-1-3.9 7H8.5L4.3 2H1v2h2l3.6 7.6-1.4 2.5c-.7 1.3.3 2.9 1.8 2.9h12v-2H7.4z"/></svg>
      <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
      <span class="nav-badge" id="navCartBadge">0</span>
    </a>
    <a href="chat.html" class="nav-item">
      <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
      <span>–ß–∞—Ç</span>
    </a>
    <a href="profile.html" class="nav-item active">
      <svg viewBox="0 0 24 24"><path d="M12 12c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4zm0 2c-2.7 0-8 1.3-8 4v2h16v-2c0-2.7-5.3-4-8-4z"/></svg>
      <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </a>
  </nav>

  <script>
    // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
    const firebaseConfig = {
      apiKey: "AIzaSyB0vkHoMqC-ec3L8EQubHFEavLYAkqr0MQ",
      authDomain: "kerben-store.firebaseapp.com",
      projectId: "kerben-store",
      storageBucket: "kerben-store.firebasestorage.app",
      messagingSenderId: "799212629498",
      appId: "1:799212629498:web:37c0576a59e38874c8eb50"
    };
    
    // Telegram Bot –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    const TELEGRAM_BOT_TOKEN = '7599592948:AAGtc_dGAcJFVQOSYcKVY0W-7GegszY9n8E';
    const TELEGRAM_CHAT_ID = '5567924440';
    
    // –î–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    const ADMIN_CUSTOMER_DATA = {
      phone: '0559009860',
      password: '13082007',
      name: '–ê–¥–∞—Ö–∞–º–∂–æ–Ω'
    };
    
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    let currentCustomer = null;
    let isAdmin = false;
    let _customerOrders = [];
    
    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
    async function init() {
      const saved = localStorage.getItem('customerData');
      if (saved) {
        try {
          currentCustomer = JSON.parse(saved);
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–ª–∏–µ–Ω—Ç –∞–¥–º–∏–Ω–æ–º
          const normalizedPhone = normalizePhone(currentCustomer.phone);
          const adminPhone = normalizePhone(ADMIN_CUSTOMER_DATA.phone);
          
          if (normalizedPhone === adminPhone || currentCustomer.isAdmin) {
            isAdmin = true;
            currentCustomer.isAdmin = true;
            localStorage.setItem('customerData', JSON.stringify(currentCustomer));
          }
          
          await loadDashboard();
        } catch(e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
          localStorage.removeItem('customerData');
          showLoginForm();
        }
      } else {
        showLoginForm();
      }
      updateCartBadge();
      
      // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º –∂–∞–ª–æ–±—ã/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
      if (currentCustomer) {
        const complaintName = document.getElementById('complaintName');
        const complaintPhone = document.getElementById('complaintPhone');
        const suggestionName = document.getElementById('suggestionName');
        const suggestionPhone = document.getElementById('suggestionPhone');
        
        if (complaintName) complaintName.value = currentCustomer.name || '';
        if (complaintPhone) complaintPhone.value = currentCustomer.phone || '';
        if (suggestionName) suggestionName.value = currentCustomer.name || '';
        if (suggestionPhone) suggestionPhone.value = currentCustomer.phone || '';
      }
    }
    
    // ==================== –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø –¢–ï–õ–ï–§–û–ù–ê ====================
    function normalizePhone(phone) {
      if (!phone) return '';
      let normalized = phone.replace(/[^\d+]/g, '');
      if (normalized.startsWith('0')) {
        normalized = '+996' + normalized.substring(1);
      }
      if (!normalized.startsWith('+')) {
        if (normalized.startsWith('996')) {
          normalized = '+' + normalized;
        } else {
          normalized = '+996' + normalized;
        }
      }
      return normalized;
    }
    
    // ==================== –§–û–†–ú–ê –í–•–û–î–ê ====================
    function showLoginForm() {
      document.getElementById('profileContent').innerHTML = `
        <div class="login-container">
          <div class="login-icon">üë§</div>
          <div class="login-title">–í—Ö–æ–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</div>
          <div class="login-subtitle">–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –∏ –ø–æ–ª—É—á–∞—Ç—å —Å–∫–∏–¥–∫–∏</div>
          <button class="login-btn" onclick="showLoginModal()">–í–æ–π—Ç–∏</button>
          <div class="register-link">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="showRegisterModal(); return false;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></div>
        </div>
      `;
    }
    
    // ==================== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –í–•–û–î–ê/–†–ï–ì–ò–°–¢–†–ê–¶–ò–ò ====================
    async function showLoginModal() {
      const { value: formValues } = await Swal.fire({
        title: 'üîê –í—Ö–æ–¥',
        html: `
          <input type="tel" id="loginPhone" class="swal2-input" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
          <input type="password" id="loginPassword" class="swal2-input" placeholder="–ü–∞—Ä–æ–ª—å">
        `,
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: '–í–æ–π—Ç–∏',
        cancelButtonText: '–û—Ç–º–µ–Ω–∞',
        confirmButtonColor: '#4CAF50',
        preConfirm: () => ({
          phone: document.getElementById('loginPhone').value,
          password: document.getElementById('loginPassword').value
        })
      });
      
      if (formValues) {
        await login(formValues.phone, formValues.password);
      }
    }
    
    async function showRegisterModal() {
      const { value: formValues } = await Swal.fire({
        title: 'üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
        html: `
          <input type="text" id="regName" class="swal2-input" placeholder="–í–∞—à–µ –∏–º—è">
          <input type="tel" id="regPhone" class="swal2-input" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
          <input type="text" id="regAddress" class="swal2-input" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">
          <input type="password" id="regPassword" class="swal2-input" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 4 —Å–∏–º–≤–æ–ª–∞)">
          <input type="password" id="regPassword2" class="swal2-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
        `,
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è',
        cancelButtonText: '–û—Ç–º–µ–Ω–∞',
        confirmButtonColor: '#4CAF50',
        preConfirm: () => {
          const name = document.getElementById('regName').value;
          const phone = document.getElementById('regPhone').value;
          const password = document.getElementById('regPassword').value;
          const password2 = document.getElementById('regPassword2').value;
          
          if (!name || !phone) {
            Swal.showValidationMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
            return false;
          }
          if (password.length < 4) {
            Swal.showValidationMessage('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞');
            return false;
          }
          if (password !== password2) {
            Swal.showValidationMessage('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
            return false;
          }
          
          return {
            name, phone,
            address: document.getElementById('regAddress').value,
            password
          };
        }
      });
      
      if (formValues) {
        await register(formValues);
      }
    }
    
    // ==================== –í–•–û–î ====================
    async function login(phone, password) {
      try {
        Swal.fire({ title: '–ü—Ä–æ–≤–µ—Ä–∫–∞...', didOpen: () => Swal.showLoading(), allowOutsideClick: false });
        
        const normalizedPhone = normalizePhone(phone);
        const snapshot = await db.collection('customers').where('phone', '==', normalizedPhone).limit(1).get();
        
        if (snapshot.empty) {
          Swal.fire({ icon: 'error', title: '–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', text: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å' });
          return;
        }
        
        const doc = snapshot.docs[0];
        const data = doc.data();
        
        if (data.password !== password) {
          Swal.fire({ icon: 'error', title: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' });
          return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∞–¥–º–∏–Ω–æ–º
        const adminPhone = normalizePhone(ADMIN_CUSTOMER_DATA.phone);
        const isAdminLogin = normalizedPhone === adminPhone && password === ADMIN_CUSTOMER_DATA.password;
        
        currentCustomer = { id: doc.id, ...data, isAdmin: isAdminLogin };
        isAdmin = isAdminLogin;
        localStorage.setItem('customerData', JSON.stringify(currentCustomer));
        
        Swal.fire({ 
          icon: 'success', 
          title: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', 
          text: currentCustomer.name + (isAdminLogin ? ' (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)' : ''), 
          timer: 1500, 
          showConfirmButton: false 
        });
        
        await loadDashboard();
        
      } catch (error) {
        console.error(error);
        Swal.fire({ icon: 'error', title: '–û—à–∏–±–∫–∞', text: '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ' });
      }
    }
    
    // ==================== –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ====================
    async function register(data) {
      try {
        Swal.fire({ title: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...', didOpen: () => Swal.showLoading(), allowOutsideClick: false });
        
        const normalizedPhone = normalizePhone(data.phone);
        
        const existing = await db.collection('customers').where('phone', '==', normalizedPhone).limit(1).get();
        if (!existing.empty) {
          Swal.fire({ icon: 'warning', title: '–¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–Ω—è—Ç', text: '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏' });
          return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∞–¥–º–∏–Ω–æ–º
        const adminPhone = normalizePhone(ADMIN_CUSTOMER_DATA.phone);
        const isAdminRegister = normalizedPhone === adminPhone && data.password === ADMIN_CUSTOMER_DATA.password;
        
        const ref = await db.collection('customers').add({
          name: data.name,
          phone: normalizedPhone,
          address: data.address || '',
          password: data.password,
          createdAt: Date.now(),
          ordersCount: 0,
          totalSpent: 0,
          isAdmin: isAdminRegister
        });
        
        currentCustomer = {
          id: ref.id,
          name: data.name,
          phone: normalizedPhone,
          address: data.address || '',
          isAdmin: isAdminRegister
        };
        
        isAdmin = isAdminRegister;
        localStorage.setItem('customerData', JSON.stringify(currentCustomer));
        
        Swal.fire({ 
          icon: 'success', 
          title: 'üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 
          text: `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${data.name}!`, 
          timer: 2000, 
          showConfirmButton: false 
        });
        
        await loadDashboard();
        
      } catch (error) {
        console.error(error);
        Swal.fire({ icon: 'error', title: '–û—à–∏–±–∫–∞', text: '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ' });
      }
    }
    
    // ==================== –ó–ê–ì–†–£–ó–ö–ê –î–ê–®–ë–û–†–î–ê ====================
    async function loadDashboard() {
      let orders = [];
      let stats = { ordersCount: 0, totalSpent: 0 };
      
      try {
        const snapshot = await db.collection('orders').where('phone', '==', currentCustomer.phone).limit(50).get();
        snapshot.forEach(doc => orders.push({ id: doc.id, ...doc.data() }));
        orders.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        
        stats.ordersCount = orders.length;
        stats.totalSpent = orders.reduce((sum, o) => sum + (o.total || 0), 0);
      } catch(e) { 
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', e); 
      }
      
      _customerOrders = orders;
      
      const statusColors = {
        '–ù–æ–≤—ã–π': '#17a2b8',
        '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ': '#ffc107',
        '–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è': '#007bff',
        '–î–æ—Å—Ç–∞–≤–ª–µ–Ω': '#28a745',
        '–í—ã–ø–æ–ª–Ω–µ–Ω': '#28a745',
        '–û—Ç–º–µ–Ω—ë–Ω': '#dc3545'
      };
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML –∑–∞–∫–∞–∑–æ–≤
      let ordersHtml = '';
      if (orders.length === 0) {
        ordersHtml = `
          <div class="empty-orders">
            <div class="empty-orders-icon">üì¶</div>
            <div>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
          </div>
        `;
      } else {
        ordersHtml = orders.slice(0, 5).map(order => {
          const date = order.time || new Date(order.timestamp).toLocaleDateString('ru-RU');
          const color = statusColors[order.status] || '#666';
          const itemsCount = order.items ? order.items.length : 0;
          
          return `
            <div class="order-card" onclick="showOrderDetails('${order.id}')">
              <div class="order-header">
                <span class="order-id">#${order.id.slice(-6).toUpperCase()}</span>
                <span class="order-status" style="background:${color}">${order.status || '–ù–æ–≤—ã–π'}</span>
              </div>
              <div class="order-date">üìÖ ${date}</div>
              <div class="order-items">üì¶ ${itemsCount} —Ç–æ–≤–∞—Ä(–æ–≤)</div>
              <div class="order-total">${(order.total || 0).toLocaleString()} —Å–æ–º</div>
            </div>
          `;
        }).join('');
        
        if (orders.length > 5) {
          ordersHtml += `<div style="text-align:center; padding:10px;"><a href="#" onclick="openOrdersWindow(); return false;" style="color:#4CAF50;">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ ${orders.length} –∑–∞–∫–∞–∑–æ–≤ ‚Üí</a></div>`;
        }
      }
      
      // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
      let adminPanelHtml = '';
      if (isAdmin || currentCustomer.isAdmin) {
        adminPanelHtml = `
          <div class="menu-section">
            <div class="menu-section-title">üîê –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>
            
            <div class="menu-item admin-menu-item" onclick="window.location.href='admin-products.html'">
              <div class="menu-item-left">
                <span class="menu-icon">‚ûï</span>
                <span class="menu-text">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</span>
              </div>
              <span class="menu-arrow">‚Ä∫</span>
            </div>
            
            <div class="menu-item admin-menu-item" onclick="window.location.href='admin-orders.html'">
              <div class="menu-item-left">
                <span class="menu-icon">üì¶</span>
                <span class="menu-text">–ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</span>
              </div>
              <span class="menu-arrow">‚Ä∫</span>
            </div>
            
            <div class="menu-item admin-menu-item" onclick="goToPage('index.html', 'openPartnersOrdersWindow')">
              <div class="menu-item-left">
                <span class="menu-icon">ü§ù</span>
                <span class="menu-text">–ó–∞–∫–∞–∑—ã –æ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</span>
              </div>
              <span class="menu-arrow">‚Ä∫</span>
            </div>
            
            <div class="menu-item admin-menu-item" onclick="window.location.href='admin-chat.html'">
              <div class="menu-item-left">
                <span class="menu-icon">üí¨</span>
                <span class="menu-text">–ß–∞—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏</span>
              </div>
              <span class="menu-arrow">‚Ä∫</span>
            </div>
            
            <div class="menu-item admin-menu-item" onclick="window.location.href='admin-profit.html'">
              <div class="menu-item-left">
                <span class="menu-icon">üí∞</span>
                <span class="menu-text">–û—Ç—á–µ—Ç –ø–æ –ø—Ä–∏–±—ã–ª–∏</span>
              </div>
              <span class="menu-arrow">‚Ä∫</span>
            </div>
            
            <div class="menu-item admin-menu-item" onclick="window.location.href='admin-sellers.html'">
              <div class="menu-item-left">
                <span class="menu-icon">üè™</span>
                <span class="menu-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏</span>
              </div>
              <span class="menu-arrow">‚Ä∫</span>
            </div>
            
            <div class="menu-item admin-menu-item" onclick="window.location.href='admin-categories.html'">
              <div class="menu-item-left">
                <span class="menu-icon">üìÅ</span>
                <span class="menu-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</span>
              </div>
              <span class="menu-arrow">‚Ä∫</span>
            </div>
            
            <div class="menu-item admin-menu-item" onclick="window.location.href='admin-agents.html'">
              <div class="menu-item-left">
                <span class="menu-icon">ü§ù</span>
                <span class="menu-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏</span>
              </div>
              <span class="menu-arrow">‚Ä∫</span>
            </div>
          </div>
        `;
      }
      
      document.getElementById('profileContent').innerHTML = `
        <div class="profile-header">
          <div class="profile-user">
            <div class="profile-avatar" onclick="editProfile()">üë§</div>
            <div class="profile-info" onclick="editProfile()">
              <div class="profile-name">${currentCustomer.name} ${isAdmin ? '<span style="font-size:12px; background:rgba(255,255,255,0.2); padding:2px 8px; border-radius:10px;">–ê–¥–º–∏–Ω</span>' : ''} <span style="font-size:12px; opacity:0.7;">‚úé</span></div>
              <div class="profile-phone">${currentCustomer.phone}</div>
            </div>
            <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
          </div>
        </div>
        
        <div class="stats-row">
          <div class="stat-item">
            <div class="stat-value">${stats.ordersCount}</div>
            <div class="stat-label">–ó–∞–∫–∞–∑–æ–≤</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">${stats.totalSpent.toLocaleString()}</div>
            <div class="stat-label">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
          </div>
        </div>
        
        <div class="menu-section">
          <div class="menu-item" onclick="openOrdersWindow()">
            <div class="menu-item-left">
              <span class="menu-icon">üìã</span>
              <span class="menu-text">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</span>
            </div>
            <div style="display:flex; align-items:center; gap:8px;">
              <span class="menu-badge">${stats.ordersCount}</span>
              <span class="menu-arrow">‚Ä∫</span>
            </div>
          </div>
          
          <a href="cart.html" class="menu-item">
            <div class="menu-item-left">
              <span class="menu-icon">üõí</span>
              <span class="menu-text">–ö–æ—Ä–∑–∏–Ω–∞</span>
            </div>
            <span class="menu-arrow">‚Ä∫</span>
          </a>
          
          <a href="chat.html" class="menu-item">
            <div class="menu-item-left">
              <span class="menu-icon">üí¨</span>
              <span class="menu-text">–ß–∞—Ç —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º</span>
            </div>
            <span class="menu-arrow">‚Ä∫</span>
          </a>
          
          <div class="menu-item" onclick="goToPage('index.html', 'openFavoritesPage')">
            <div class="menu-item-left">
              <span class="menu-icon">‚ù§Ô∏è</span>
              <span class="menu-text">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </div>
            <span class="menu-arrow">‚Ä∫</span>
          </div>
          
          <div class="menu-item" onclick="openComplaintWindow()">
            <div class="menu-item-left">
              <span class="menu-icon">‚ö†Ô∏è</span>
              <span class="menu-text">–ñ–∞–ª–æ–±–∞</span>
            </div>
            <span class="menu-arrow">‚Ä∫</span>
          </div>
          
          <div class="menu-item" onclick="openSuggestionWindow()">
            <div class="menu-item-left">
              <span class="menu-icon">üí°</span>
              <span class="menu-text">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–æ–≤–∞—Ä</span>
            </div>
            <span class="menu-arrow">‚Ä∫</span>
          </div>
          
          <div class="menu-item" onclick="window.location.href='agent-profit.html'">
            <div class="menu-item-left">
              <span class="menu-icon">üí∞</span>
              <span class="menu-text">–ú–æ—è –ø—Ä–∏–±—ã–ª—å (–∞–≥–µ–Ω—Ç)</span>
            </div>
            <span class="menu-arrow">‚Ä∫</span>
          </div>
          
          <div class="menu-item" onclick="openBecomeSellerWindow()">
            <div class="menu-item-left">
              <span class="menu-icon">üè™</span>
              <span class="menu-text">–°—Ç–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–æ–º</span>
            </div>
            <span class="menu-arrow">‚Ä∫</span>
          </div>
          
          ${!isAdmin && !currentCustomer.isAdmin ? `
          <div class="menu-item" onclick="openAdminLogin()">
            <div class="menu-item-left">
              <span class="menu-icon">üîê</span>
              <span class="menu-text">–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∞</span>
            </div>
            <span class="menu-arrow">‚Ä∫</span>
          </div>
          ` : ''}
        </div>
        
        ${adminPanelHtml}
        
        <div class="orders-section">
          <div class="section-title">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</div>
          ${ordersHtml}
        </div>
        
        <div style="height:20px;"></div>
      `;
    }
    
    // ==================== –ü–ï–†–ï–•–û–î –ù–ê –°–¢–†–ê–ù–ò–¶–£ –° –§–£–ù–ö–¶–ò–ï–ô ====================
    function goToPage(page, funcName) {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã–∑–æ–≤–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      localStorage.setItem('callAfterLoad', funcName);
      window.location.href = page;
    }
    
    // ==================== –í–•–û–î –î–õ–Ø –ê–î–ú–ò–ù–ê ====================
    async function openAdminLogin() {
      const { value: password } = await Swal.fire({
        title: 'üîê –í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',
        input: 'password',
        inputPlaceholder: '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',
        showCancelButton: true,
        confirmButtonText: '–í–æ–π—Ç–∏',
        cancelButtonText: '–û—Ç–º–µ–Ω–∞',
        confirmButtonColor: '#28a745'
      });
      
      if (password) {
        if (password === ADMIN_CUSTOMER_DATA.password) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
          const userPhone = normalizePhone(currentCustomer.phone);
          const adminPhone = normalizePhone(ADMIN_CUSTOMER_DATA.phone);
          
          if (userPhone !== adminPhone) {
            Swal.fire({
              icon: 'error',
              title: '‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω',
              text: '–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–æ–º–µ—Ä–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞'
            });
            return;
          }
          
          // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
          currentCustomer.isAdmin = true;
          isAdmin = true;
          localStorage.setItem('customerData', JSON.stringify(currentCustomer));
          
          Swal.fire({
            icon: 'success',
            title: '‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥',
            text: '–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!',
            timer: 1500,
            showConfirmButton: false
          }).then(() => {
            loadDashboard();
          });
        } else {
          Swal.fire({ icon: 'error', title: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' });
        }
      }
    }
    
    // ==================== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–§–ò–õ–Ø ====================
    async function editProfile() {
      const { value: formValues } = await Swal.fire({
        title: '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å',
        html: `
          <div style="text-align:left;">
            <div style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px; font-weight:600;">üë§ –ò–º—è:</label>
              <input type="text" id="editName" value="${currentCustomer.name}" class="swal2-input" style="width:100%;">
            </div>
            <div style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px; font-weight:600;">üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
              <input type="text" id="editAddress" value="${currentCustomer.address || ''}" class="swal2-input" style="width:100%;">
            </div>
            <div style="padding:10px; background:#fff3e0; border-radius:8px; font-size:13px; color:#e65100;">
              üí° –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å
            </div>
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
        cancelButtonText: '–û—Ç–º–µ–Ω–∞',
        confirmButtonColor: '#4CAF50',
        preConfirm: () => {
          const name = document.getElementById('editName').value.trim();
          if (!name) {
            Swal.showValidationMessage('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
            return false;
          }
          return {
            name,
            address: document.getElementById('editAddress').value.trim()
          };
        }
      });
      
      if (formValues) {
        try {
          await db.collection('customers').doc(currentCustomer.id).update({
            name: formValues.name,
            address: formValues.address
          });
          
          currentCustomer.name = formValues.name;
          currentCustomer.address = formValues.address;
          localStorage.setItem('customerData', JSON.stringify(currentCustomer));
          
          Swal.fire({ icon: 'success', title: '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω!', timer: 1500, showConfirmButton: false });
          loadDashboard();
        } catch (error) {
          Swal.fire({ icon: 'error', title: '–û—à–∏–±–∫–∞', text: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å' });
        }
      }
    }
    
    // ==================== –í–´–•–û–î ====================
    function logout() {
      Swal.fire({
        title: '–í—ã–π—Ç–∏?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: '–î–∞, –≤—ã–π—Ç–∏',
        cancelButtonText: '–û—Ç–º–µ–Ω–∞',
        confirmButtonColor: '#dc3545'
      }).then(r => {
        if (r.isConfirmed) {
          localStorage.removeItem('customerData');
          currentCustomer = null;
          isAdmin = false;
          showLoginForm();
        }
      });
    }
    
    // ==================== –û–ö–ù–û –ó–ê–ö–ê–ó–û–í ====================
    function openOrdersWindow() {
      const orders = _customerOrders || [];
      
      const statusColors = {
        '–ù–æ–≤—ã–π': '#2196F3',
        '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ': '#FF9800',
        '–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è': '#9C27B0',
        '–î–æ—Å—Ç–∞–≤–ª–µ–Ω': '#4CAF50',
        '–í—ã–ø–æ–ª–Ω–µ–Ω': '#4CAF50',
        '–û—Ç–º–µ–Ω—ë–Ω': '#f44336'
      };
      
      let html = '';
      if (orders.length === 0) {
        html = `<div class="empty-orders"><div class="empty-orders-icon">üì¶</div><div>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div></div>`;
      } else {
        html = orders.map(order => {
          const date = order.time || new Date(order.timestamp).toLocaleDateString('ru-RU');
          const color = statusColors[order.status] || '#666';
          const itemsCount = order.items ? order.items.length : 0;
          
          return `
            <div onclick="showOrderDetails('${order.id}')" style="background:#fff; padding:15px; border-bottom:1px solid #f0f0f0; cursor:pointer;">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                <span style="font-size:14px; font-weight:600; color:#333;">#${order.id.slice(-6).toUpperCase()}</span>
                <span style="font-size:11px; padding:4px 8px; background:${color}; color:white; border-radius:4px;">${order.status || '–ù–æ–≤—ã–π'}</span>
              </div>
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="font-size:13px; color:#888;">${date} ¬∑ ${itemsCount} —Ç–æ–≤–∞—Ä(–æ–≤)</div>
                <div style="font-size:15px; font-weight:600; color:#333;">${(order.total || 0).toLocaleString()} —Å–æ–º</div>
              </div>
            </div>
          `;
        }).join('');
      }
      
      document.getElementById('ordersWindowContent').innerHTML = html;
      document.getElementById('ordersWindow').style.display = 'flex';
    }
    
    function closeOrdersWindow() {
      document.getElementById('ordersWindow').style.display = 'none';
    }
    
    // ==================== –î–ï–¢–ê–õ–ò –ó–ê–ö–ê–ó–ê ====================
    async function showOrderDetails(orderId) {
      try {
        let order = _customerOrders.find(o => o.id === orderId);
        
        if (!order) {
          const doc = await db.collection('orders').doc(orderId).get();
          if (doc.exists) {
            order = { id: doc.id, ...doc.data() };
          }
        }
        
        if (!order) {
          Swal.fire('–û—à–∏–±–∫–∞', '–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
          return;
        }
        
        const date = order.time || new Date(order.timestamp).toLocaleDateString('ru-RU');
        const statusColors = {
          '–ù–æ–≤—ã–π': '#17a2b8',
          '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ': '#ffc107',
          '–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è': '#007bff',
          '–î–æ—Å—Ç–∞–≤–ª–µ–Ω': '#28a745',
          '–í—ã–ø–æ–ª–Ω–µ–Ω': '#28a745',
          '–û—Ç–º–µ–Ω—ë–Ω': '#dc3545'
        };
        const color = statusColors[order.status] || '#666';
        
        let itemsHtml = '';
        if (order.items && order.items.length > 0) {
          itemsHtml = order.items.map(item => `
            <div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #f0f0f0;">
              <div style="flex:1;">
                <div style="font-weight:500;">${item.title}${item.variant ? ` (${item.variant})` : ''}</div>
                <div style="font-size:12px; color:#666;">${item.qty} √ó ${item.price} —Å–æ–º</div>
              </div>
              <div style="font-weight:600; color:#333;">${item.qty * item.price} —Å–æ–º</div>
            </div>
          `).join('');
        }
        
        Swal.fire({
          title: `–ó–∞–∫–∞–∑ #${orderId.slice(-6).toUpperCase()}`,
          html: `
            <div style="text-align:left;">
              <div style="margin-bottom:15px; padding:10px; background:#f8f9fa; border-radius:8px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                  <span style="color:#666;">–°—Ç–∞—Ç—É—Å:</span>
                  <span style="padding:4px 12px; background:${color}; color:white; border-radius:12px; font-size:13px;">${order.status || '–ù–æ–≤—ã–π'}</span>
                </div>
                <div style="margin-top:8px; color:#666; font-size:13px;">üìÖ ${date}</div>
                <div style="margin-top:5px; color:#666; font-size:13px;">üìç ${order.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
              </div>
              
              <div style="font-weight:600; margin-bottom:10px;">–¢–æ–≤–∞—Ä—ã:</div>
              <div style="max-height:200px; overflow-y:auto;">
                ${itemsHtml}
              </div>
              
              <div style="margin-top:15px; padding-top:15px; border-top:2px solid #4CAF50; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:16px; font-weight:600;">–ò—Ç–æ–≥–æ:</span>
                <span style="font-size:20px; font-weight:700; color:#4CAF50;">${(order.total || 0).toLocaleString()} —Å–æ–º</span>
              </div>
            </div>
          `,
          confirmButtonText: '–ó–∞–∫—Ä—ã—Ç—å',
          confirmButtonColor: '#4CAF50',
          showCancelButton: order.status === '–ù–æ–≤—ã–π',
          cancelButtonText: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑',
          cancelButtonColor: '#dc3545'
        }).then(async (result) => {
          if (result.dismiss === Swal.DismissReason.cancel && order.status === '–ù–æ–≤—ã–π') {
            const confirm = await Swal.fire({
              title: '–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?',
              text: '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å',
              icon: 'warning',
              showCancelButton: true,
              confirmButtonText: '–î–∞, –æ—Ç–º–µ–Ω–∏—Ç—å',
              cancelButtonText: '–ù–µ—Ç',
              confirmButtonColor: '#dc3545'
            });
            
            if (confirm.isConfirmed) {
              try {
                await db.collection('orders').doc(orderId).update({ status: '–û—Ç–º–µ–Ω—ë–Ω' });
                Swal.fire('–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω', '', 'success');
                await loadDashboard();
              } catch (e) {
                Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑', 'error');
              }
            }
          }
        });
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞:', error);
        Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞', 'error');
      }
    }
    
    // ==================== –ñ–ê–õ–û–ë–ê ====================
    function openComplaintWindow() {
      // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
      if (currentCustomer) {
        document.getElementById('complaintName').value = currentCustomer.name || '';
        document.getElementById('complaintPhone').value = currentCustomer.phone || '';
      }
      document.getElementById('complaintWindow').style.display = 'flex';
    }
    
    function closeComplaintWindow() {
      document.getElementById('complaintWindow').style.display = 'none';
    }
    
    async function sendComplaint() {
      const name = document.getElementById('complaintName').value.trim();
      const phone = document.getElementById('complaintPhone').value.trim();
      const category = document.getElementById('complaintCategory').value;
      const text = document.getElementById('complaintText').value.trim();
      
      if (!name) { Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è', 'error'); return; }
      if (!phone) { Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'error'); return; }
      if (!category) { Swal.fire('–û—à–∏–±–∫–∞', '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∂–∞–ª–æ–±—ã', 'error'); return; }
      if (!text) { Swal.fire('–û—à–∏–±–∫–∞', '–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É', 'error'); return; }
      
      const categoryNames = {
        'quality': 'üî¥ –ö–∞—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞',
        'delivery': 'üöö –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π',
        'service': 'üë§ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
        'price': 'üí∞ –ù–µ–≤–µ—Ä–Ω–∞—è —Ü–µ–Ω–∞',
        'other': 'üìù –î—Ä—É–≥–æ–µ'
      };
      
      const message = `‚ö†Ô∏è *–ñ–ê–õ–û–ë–ê –û–¢ –ö–õ–ò–ï–ù–¢–ê*\n\n` +
        `üë§ *–ò–º—è:* ${name}\n` +
        `üì± *–¢–µ–ª–µ—Ñ–æ–Ω:* ${phone}\n` +
        `üìÇ *–ö–∞—Ç–µ–≥–æ—Ä–∏—è:* ${categoryNames[category]}\n\n` +
        `üìù *–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:*\n${text}\n\n` +
        `üïê *–î–∞—Ç–∞:* ${new Date().toLocaleString('ru-RU')}`;
      
      try {
        Swal.fire({ title: '–û—Ç–ø—Ä–∞–≤–∫–∞ –∂–∞–ª–æ–±—ã...', didOpen: () => Swal.showLoading(), allowOutsideClick: false });
        
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: message,
            parse_mode: 'Markdown'
          })
        });
        
        const result = await response.json();
        
        if (result.ok) {
          closeComplaintWindow();
          Swal.fire({
            icon: 'success',
            title: '–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!',
            text: '–ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–∞—à—É –∂–∞–ª–æ–±—É –∏ —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏'
          });
        } else {
          throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        Swal.fire({ icon: 'error', title: '–û—à–∏–±–∫–∞', text: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.' });
      }
    }
    
    // ==================== –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï –¢–û–í–ê–†–ê ====================
    function openSuggestionWindow() {
      if (currentCustomer) {
        document.getElementById('suggestionName').value = currentCustomer.name || '';
        document.getElementById('suggestionPhone').value = currentCustomer.phone || '';
      }
      document.getElementById('suggestionWindow').style.display = 'flex';
    }
    
    function closeSuggestionWindow() {
      document.getElementById('suggestionWindow').style.display = 'none';
    }
    
    async function sendSuggestion() {
      const name = document.getElementById('suggestionName').value.trim();
      const phone = document.getElementById('suggestionPhone').value.trim();
      const productName = document.getElementById('suggestionProductName').value.trim();
      const currentPrice = document.getElementById('suggestionCurrentPrice').value.trim();
      const price = document.getElementById('suggestionPrice').value.trim();
      const description = document.getElementById('suggestionDescription').value.trim();
      const photoInput = document.getElementById('suggestionPhoto');
      
      if (!name) { Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è', 'error'); return; }
      if (!phone) { Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω', 'error'); return; }
      if (!productName) { Swal.fire('–û—à–∏–±–∫–∞', '–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error'); return; }
      if (!description) { Swal.fire('–û—à–∏–±–∫–∞', '–û–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä –ø–æ–¥—Ä–æ–±–Ω–µ–µ', 'error'); return; }
      
      try {
        document.getElementById('suggestionLoader').style.display = 'flex';
        document.getElementById('suggestionSubmitBtn').disabled = true;
        
        let message = `üí° *–ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï –¢–û–í–ê–†–ê*\n\n` +
          `üë§ *–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞:* ${name}\n` +
          `üì± *–¢–µ–ª–µ—Ñ–æ–Ω:* ${phone}\n` +
          `üè∑Ô∏è *–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:* ${productName}\n` +
          `üíµ *–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:* ${currentPrice ? currentPrice + ' —Å–æ–º' : '–Ω–µ —É–∫–∞–∑–∞–Ω–∞'}\n` +
          `üí∞ *–ñ–µ–ª–∞–µ–º–∞—è —Ü–µ–Ω–∞:* ${price ? price + ' —Å–æ–º' : '–Ω–µ —É–∫–∞–∑–∞–Ω–∞'}\n\n` +
          `üìù *–û–ø–∏—Å–∞–Ω–∏–µ:*\n${description}\n\n` +
          `üïê *–î–∞—Ç–∞:* ${new Date().toLocaleString('ru-RU')}`;
        
        let result;
        
        if (photoInput.files && photoInput.files[0]) {
          const telegramFormData = new FormData();
          telegramFormData.append('chat_id', TELEGRAM_CHAT_ID);
          telegramFormData.append('photo', photoInput.files[0]);
          telegramFormData.append('caption', message);
          
          const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
            method: 'POST',
            body: telegramFormData
          });
          
          result = await response.json();
        } else {
          const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: TELEGRAM_CHAT_ID,
              text: message,
              parse_mode: 'Markdown'
            })
          });
          
          result = await response.json();
        }
        
        document.getElementById('suggestionLoader').style.display = 'none';
        document.getElementById('suggestionSubmitBtn').disabled = false;
        
        if (result.ok) {
          closeSuggestionWindow();
          Swal.fire({
            icon: 'success',
            title: '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!',
            text: '–°–ø–∞—Å–∏–±–æ! –ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.'
          });
        } else {
          throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        document.getElementById('suggestionLoader').style.display = 'none';
        document.getElementById('suggestionSubmitBtn').disabled = false;
        Swal.fire({ icon: 'error', title: '–û—à–∏–±–∫–∞', text: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.' });
      }
    }
    
    // ==================== –°–¢–ê–¢–¨ –ü–†–û–î–ê–í–¶–û–ú ====================
    function openBecomeSellerWindow() {
      document.getElementById('becomeSellerWindow').style.display = 'flex';
      switchSellerTab('register');
      
      // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º
      document.getElementById('sellerName').value = '';
      document.getElementById('sellerPhone').value = '';
      document.getElementById('sellerPassword').value = '';
      document.getElementById('sellerCity').value = '';
      document.getElementById('sellerProducts').value = '';
      document.getElementById('sellerTelegramId').value = '';
      document.getElementById('sellerLoginPhone').value = '';
      document.getElementById('sellerLoginPassword').value = '';
    }
    
    function closeBecomeSellerWindow() {
      document.getElementById('becomeSellerWindow').style.display = 'none';
    }
    
    function switchSellerTab(tab) {
      const registerTab = document.getElementById('sellerTabRegister');
      const loginTab = document.getElementById('sellerTabLogin');
      const registerForm = document.getElementById('sellerRegisterForm');
      const loginForm = document.getElementById('sellerLoginForm');
      
      if (tab === 'register') {
        registerTab.classList.add('active');
        loginTab.classList.remove('active');
        registerForm.style.display = 'block';
        loginForm.style.display = 'none';
      } else {
        loginTab.classList.add('active');
        registerTab.classList.remove('active');
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
      }
    }
    
    async function registerSeller() {
      const name = document.getElementById('sellerName').value.trim();
      const phone = document.getElementById('sellerPhone').value.trim();
      const password = document.getElementById('sellerPassword').value.trim();
      const city = document.getElementById('sellerCity').value.trim();
      const products = document.getElementById('sellerProducts').value.trim();
      const telegramId = document.getElementById('sellerTelegramId').value.trim();
      
      if (!name) { Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏', 'error'); return; }
      if (!phone) { Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω', 'error'); return; }
      if (!password || password.length < 4) { Swal.fire('–û—à–∏–±–∫–∞', '–ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞', 'error'); return; }
      if (!city) { Swal.fire('–û—à–∏–±–∫–∞', '–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥', 'error'); return; }
      
      try {
        document.getElementById('sellerLoader').style.display = 'flex';
        document.getElementById('sellerSubmitBtn').disabled = true;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç –ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω
        const existing = await db.collection('sellers').where('phone', '==', phone).get();
        if (!existing.empty) {
          document.getElementById('sellerLoader').style.display = 'none';
          document.getElementById('sellerSubmitBtn').disabled = false;
          Swal.fire('–û—à–∏–±–∫–∞', '–≠—Ç–æ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ö–æ–¥.', 'error');
          return;
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–∞–≤—Ü–∞
        await db.collection('sellers').add({
          name,
          phone,
          password,
          city,
          products,
          telegramId: telegramId || '',
          status: 'pending',
          createdAt: Date.now()
        });
        
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
        const message = `üè™ *–ù–û–í–´–ô –ü–†–û–î–ê–í–ï–¶*\n\n` +
          `üë§ *–ò–º—è:* ${name}\n` +
          `üì± *–¢–µ–ª–µ—Ñ–æ–Ω:* ${phone}\n` +
          `üèôÔ∏è *–ì–æ—Ä–æ–¥:* ${city}\n` +
          `üì¶ *–¢–æ–≤–∞—Ä—ã:* ${products || '–Ω–µ —É–∫–∞–∑–∞–Ω—ã'}\n` +
          `üì± *Telegram ID:* ${telegramId || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\n\n` +
          `üïê *–î–∞—Ç–∞:* ${new Date().toLocaleString('ru-RU')}`;
        
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: message,
            parse_mode: 'Markdown'
          })
        });
        
        document.getElementById('sellerLoader').style.display = 'none';
        document.getElementById('sellerSubmitBtn').disabled = false;
        
        closeBecomeSellerWindow();
        Swal.fire({
          icon: 'success',
          title: '–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!',
          html: `<p>–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø—Ä–æ–¥–∞–≤—Ü–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.</p>
                 <p style="color:#666;">–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>`
        });
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        document.getElementById('sellerLoader').style.display = 'none';
        document.getElementById('sellerSubmitBtn').disabled = false;
        Swal.fire({ icon: 'error', title: '–û—à–∏–±–∫–∞', text: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É' });
      }
    }
    
    async function loginSeller() {
      const phone = document.getElementById('sellerLoginPhone').value.trim();
      const password = document.getElementById('sellerLoginPassword').value.trim();
      
      if (!phone || !password) {
        Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–∞—Ä–æ–ª—å', 'error');
        return;
      }
      
      try {
        document.getElementById('sellerLoader').style.display = 'flex';
        
        const snapshot = await db.collection('sellers').where('phone', '==', phone).limit(1).get();
        
        if (snapshot.empty) {
          document.getElementById('sellerLoader').style.display = 'none';
          Swal.fire('–û—à–∏–±–∫–∞', '–ü—Ä–æ–¥–∞–≤–µ—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
          return;
        }
        
        const doc = snapshot.docs[0];
        const data = doc.data();
        
        if (data.password !== password) {
          document.getElementById('sellerLoader').style.display = 'none';
          Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
          return;
        }
        
        if (data.status !== 'approved') {
          document.getElementById('sellerLoader').style.display = 'none';
          Swal.fire('–û–∂–∏–¥–∞–Ω–∏–µ', '–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –µ—â—ë –Ω–µ –æ–¥–æ–±—Ä–µ–Ω–∞. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–æ–≤–µ—Ä–∫–∏.', 'info');
          return;
        }
        
        // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
        const sellerData = { id: doc.id, ...data };
        localStorage.setItem('sellerData', JSON.stringify(sellerData));
        
        document.getElementById('sellerLoader').style.display = 'none';
        closeBecomeSellerWindow();
        
        Swal.fire({
          icon: 'success',
          title: `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${data.name}!`,
          text: '–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –ø—Ä–æ–¥–∞–≤–µ—Ü',
          timer: 2000,
          showConfirmButton: false
        }).then(() => {
          // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
          window.location.href = 'index.html';
        });
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        document.getElementById('sellerLoader').style.display = 'none';
        Swal.fire({ icon: 'error', title: '–û—à–∏–±–∫–∞', text: '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ' });
      }
    }
    
    // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ë–ï–ô–î–ñ–ê –ö–û–†–ó–ò–ù–´ ====================
    function updateCartBadge() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const badge = document.getElementById('navCartBadge');
      if (badge) {
        badge.textContent = cart.length;
        badge.style.display = cart.length > 0 ? 'flex' : 'none';
      }
    }
    
    // ==================== –ó–ê–ü–£–°–ö ====================
    document.addEventListener('DOMContentLoaded', init);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
    window.addEventListener('storage', (e) => {
      if (e.key === 'cart') updateCartBadge();
    });
  </script>
</body>
</html>